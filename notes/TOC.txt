31/12/2025
Discussion with chatGPT to add a TOC with a draggable vertical separator to the
HTML files generated by scripts/md2html4xtr.rex

https://chatgpt.com/share/69568aa4-7e84-8007-83bd-c84a6117801d

Here is a short excerpt from this conversation...

In Bootstrap 3.x, grid columns are implemented using float: left:
    .col-md-3 {
      float: left;
    }

The TOC lives here:
    <div class="col-md-3">
      <aside class="outline">
        <nav id="toc">...</nav>
      </aside>
    </div>

position: sticky cannot work inside a floated ancestor.
Bootstrap 3 columns (.col-md-*) are floated.

The Strategy (Minimal and Safe)
1. Keep Bootstrap
2. Disable floats only for this row
3. Replace the row layout with Flexbox
4. Make the TOC sticky inside the sidebar
This is the smallest possible change.

Step 1 — Target Only This Row
Add a class to the row that contains content + TOC:
    <div class="row layout-main">
      <div class="col-md-9">
        ...
      </div>
      <div class="col-md-3">
        %sidebar%
      </div>
    </div>

Step 2 — Neutralize Bootstrap Floats Only Here
    .layout-main {
      display: flex;
      align-items: flex-start;
    }

    .layout-main > [class*="col-"] {
      float: none;      // disables Bootstrap 3 floats
    }

Step 3 — Make the TOC Sticky (Correctly)
    #toc {
      position: sticky;
      top: 80px;
    }

Step 4 — (Optional but Recommended) Ensure No Hidden Overflow
    .container,
    .row,
    .col-md-3 {
      overflow: visible;
    }
This is defensive and avoids future regressions.

TOC is not yet sticky.
There is one remaining, non-obvious Bootstrap 3 + Flexbox interaction that explains the behavior exactly.
Your sidebar column does not have enough height for sticky to engage.
position: sticky only activates when the sticky element’s containing block is taller than the sticky element itself.

Bootstrap .container has padding-left and padding-right, and .row has negative margins to compensate:
    .container { width: …; padding-left: 15px; padding-right: 15px; }
    .row { margin-left: -15px; margin-right: -15px; }
- position: sticky is relative to the nearest scrolling container (the containing block)
- The containing block for #toc is the .col-md-3
- BUT .col-md-3 does not have a height that fills the .row, because .row itself is not a flex container by default (Bootstrap 3)
- Even though you set .layout-main { display: flex; }, you did not set the sidebar to stretch properly inside the row → .col-md-3 is only as tall as its own content
- Sticky requires the parent container height to exceed the sticky element’s height
So sticky is never activating, because the parent .col-md-3 is short.

Step 1 — Ensure flex stretching
Your .layout-main CSS should be:
    .layout-main {
      display: flex;
      align-items: stretch;     // ensures all columns are same height
    }
This makes .col-md-3 as tall as the main content column

Step 2 — Make the sidebar itself a flex container (so TOC fills it)
    .col-md-3 {
      display: flex;
      flex-direction: column;
    }
Now the <aside> and the TOC can stick relative to the full-height column.

Step 3 — Make TOC sticky inside the sidebar
    .outline {
      flex: 1 1 auto;   // optional
    }

    #toc {
      position: sticky;
      top: 80px;
    }

Step 4 — Optional: prevent horizontal issues with Bootstrap gutters
Because .container and .row have padding/margin:
    .row.layout-main {
      margin-left: 0;
      margin-right: 0;
    }
This keeps the sidebar width predictable.


The next step is making it scrollable vertically if it grows taller than the viewport (or the column).
Make TOC scrollable
The trick is:
The TOC itself (#toc) should fill the available height of the sidebar
Then use overflow-y: auto to scroll when content exceeds that height

    .col-md-3 {
      display: flex;
      flex-direction: column;
    }

    #toc {
      position: sticky;
      top: 80px;

      flex: 1 1 auto;                   // grow/shrink inside sidebar column
      max-height: calc(100vh - 80px);   // viewport minus sticky offset
      overflow-y: auto;                 // vertical scrollbar when needed
      padding-right: 8px;               // optional, prevent scrollbar overlap
    }

Explanation of key properties
    Property	                    Purpose
    flex: 1 1 auto	                Allows TOC to fill the sidebar height but still shrink if content is short
    max-height: calc(100vh - 80px)	Ensures TOC never exceeds the visible viewport minus sticky top
    overflow-y: auto	            Adds vertical scrollbar when TOC content is taller than available height
    padding-right	                Prevents the scrollbar from overlapping text (optional)

Notes
    - The sticky top: 80px still works; the scrollbar is inside the sticky element itself
    - Scroll events inside TOC are independent of main content scroll
    - No JS needed for this; pure CSS
    - Works well for long documents or many nested headings

