<!-- HTML header for doxygen 1.9.2-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ooRexx: ActivityManager.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!--
    Removed completely the TITLEAREA because I don't like the loss of space.
    I want the title in the condensed index (tabs) at top of each HTML page.
    The insertion of the title is managed by javascript code in the footer,
    because this code must be executed AFTER the creation of the condensed index.
    Must have this setting to display the condensed index:
    DISABLE_INDEX = NO
-->
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_activity_manager_8cpp_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">ActivityManager.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_activity_manager_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">/*                                                                            */</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">/* Copyright (c) 1995, 2004 IBM Corporation. All rights reserved.             */</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">/* Copyright (c) 2005-2019 Rexx Language Association. All rights reserved.    */</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">/*                                                                            */</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">/* This program and the accompanying materials are made available under       */</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">/* the terms of the Common Public License v1.0 which accompanies this         */</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">/* distribution. A copy is also available at the following address:           */</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">/* https://www.oorexx.org/license.html                                        */</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">/*                                                                            */</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">/* Redistribution and use in source and binary forms, with or                 */</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">/* without modification, are permitted provided that the following            */</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">/* conditions are met:                                                        */</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">/*                                                                            */</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">/* Redistributions of source code must retain the above copyright             */</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">/* notice, this list of conditions and the following disclaimer.              */</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">/* Redistributions in binary form must reproduce the above copyright          */</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">/* notice, this list of conditions and the following disclaimer in            */</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">/* the documentation and/or other materials provided with the distribution.   */</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">/*                                                                            */</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">/* Neither the name of Rexx Language Association nor the names                */</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">/* of its contributors may be used to endorse or promote products             */</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">/* derived from this software without specific prior written permission.      */</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">/*                                                                            */</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">/* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS        */</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">/* &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT          */</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">/* LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS          */</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">/* FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT   */</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">/* OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,      */</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">/* SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED   */</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">/* TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,        */</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">/* OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY     */</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">/* OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING    */</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">/* NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS         */</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">/* SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.               */</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">/*                                                                            */</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">/*----------------------------------------------------------------------------*/</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160; </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_rexx_core_8h.html">RexxCore.h</a>&quot;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_activity_8hpp.html">Activity.hpp</a>&quot;</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_rexx_activation_8hpp.html">RexxActivation.hpp</a>&quot;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_directory_class_8hpp.html">DirectoryClass.hpp</a>&quot;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_activity_manager_8hpp.html">ActivityManager.hpp</a>&quot;</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_interpreter_8hpp.html">Interpreter.hpp</a>&quot;</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_protected_object_8hpp.html">ProtectedObject.hpp</a>&quot;</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_interpreter_instance_8hpp.html">InterpreterInstance.hpp</a>&quot;</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_native_activation_8hpp.html">NativeActivation.hpp</a>&quot;</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &quot;SysActivity.hpp&quot;</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_queue_class_8hpp.html">QueueClass.hpp</a>&quot;</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_global_protected_object_8hpp.html">GlobalProtectedObject.hpp</a>&quot;</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160; </div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">// The currently active activity.</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<a class="code" href="class_activity.html">Activity</a> *<span class="keyword">volatile</span> <a class="code" href="class_activity_manager.html#a79b68d826eb48037838a9eab89e730fe">ActivityManager::currentActivity</a> = <a class="code" href="_rexx_core_8h.html#a181a36438ba4535dd7d22ab63239d1e1">OREF_NULL</a>;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160; </div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">// this is a volatile variable used to ensure instruction ordering</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="keyword">volatile</span> <span class="keywordtype">bool</span> <a class="code" href="class_activity_manager.html#adb0c7cefcddab6472aafa4cf14d63276">ActivityManager::sentinel</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">// available activities we can reuse</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<a class="code" href="class_queue_class.html">QueueClass</a> *<a class="code" href="class_activity_manager.html#a0cfa9ecefdc20abfe92237d7cdf6c62c">ActivityManager::availableActivities</a> = <a class="code" href="_rexx_core_8h.html#a181a36438ba4535dd7d22ab63239d1e1">OREF_NULL</a>;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160; </div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">// table of all activities</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<a class="code" href="class_queue_class.html">QueueClass</a> *<a class="code" href="class_activity_manager.html#a1695008449800eabf5aacab6e4ca3ec2">ActivityManager::allActivities</a> = <a class="code" href="_rexx_core_8h.html#a181a36438ba4535dd7d22ab63239d1e1">OREF_NULL</a>;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160; </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;std::deque&lt;Activity *&gt;<a class="code" href="class_activity_manager.html#a374af8561e8974a80fb0f976eeeda701">ActivityManager::waitingActivities</a>;   <span class="comment">// queue of waiting activities</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160; </div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="keywordtype">size_t</span> <a class="code" href="class_activity_manager.html#aa5e18d89bf550489c15da86f9f21e117">ActivityManager::waitingAttaches</a> = 0;                <span class="comment">// count of waiting external attaches</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160; </div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="keywordtype">size_t</span> <a class="code" href="class_activity_manager.html#a6dcf364f11149e8b8ae78c31e86ff460">ActivityManager::waitingAccess</a> = 0;                  <span class="comment">// count of activities currently awaiting access</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160; </div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="keywordtype">size_t</span> <a class="code" href="class_activity_manager.html#a3ae96cdf24c0cecc1074df9e60b4478c">ActivityManager::waitingApiAccess</a> = 0;               <span class="comment">// count of activities currently awaiting API access</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160; </div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<a class="code" href="windows_2rexxapitypes_8h.html#aec6fcb673ff035718c238c8c9d544c47">uint64_t</a> <a class="code" href="class_activity_manager.html#a3c78d6dfe8be801f5533f5f2820d5570">ActivityManager::lastLockTime</a> = 0;                 <span class="comment">// the last time we granted the kernel lock.</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160; </div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">// process shutting down flag</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_activity_manager.html#a0083bef91fb6b8a26f8738b7bfb9e24a">ActivityManager::processTerminating</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160; </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">// number of active interpreter instances in this process</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="keywordtype">size_t</span> <a class="code" href="class_activity_manager.html#a49aa623a244c04ab727e9d421ac5ebcd">ActivityManager::interpreterInstances</a> = 0;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160; </div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">// global lock for the interpreter</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<a class="code" href="class_sys_mutex.html">SysMutex</a> <a class="code" href="class_activity_manager.html#ac4eda8b811909cca248959db37e5834e">ActivityManager::kernelSemaphore</a>;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160; </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">// the termination complete semaphore</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<a class="code" href="class_sys_semaphore.html">SysSemaphore</a> <a class="code" href="class_activity_manager.html#a01366e1f82be7ff807af6e69d1f09080">ActivityManager::terminationSem</a>;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160; </div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment"> * Initialize the activity manager when the interpreter starts up.</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00090"></a><span class="lineno"><a class="line" href="class_activity_manager.html#a59f65b6fc5772088b35d9d4d062db793">   90</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_activity_manager.html#a59f65b6fc5772088b35d9d4d062db793">ActivityManager::init</a>()</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;{</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <a class="code" href="class_activity_manager.html#a0cfa9ecefdc20abfe92237d7cdf6c62c">availableActivities</a> = <a class="code" href="_queue_class_8hpp.html#aa8a6cd98d6466c32c590ec18c39874e6">new_queue</a>();</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <a class="code" href="class_activity_manager.html#a1695008449800eabf5aacab6e4ca3ec2">allActivities</a> = <a class="code" href="_queue_class_8hpp.html#aa8a6cd98d6466c32c590ec18c39874e6">new_queue</a>();</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <a class="code" href="class_activity_manager.html#a79b68d826eb48037838a9eab89e730fe">currentActivity</a> = <a class="code" href="_rexx_core_8h.html#a181a36438ba4535dd7d22ab63239d1e1">OREF_NULL</a>;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;}</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160; </div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment"> * Live marking of the objects owned by the activity manager.</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment"> * @param liveMark The current live mark value.</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00103"></a><span class="lineno"><a class="line" href="class_activity_manager.html#aa11d586f0ebd7e07264a00003cc42ed7">  103</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_activity_manager.html#aa11d586f0ebd7e07264a00003cc42ed7">ActivityManager::live</a>(<span class="keywordtype">size_t</span> liveMark)</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;{</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <a class="code" href="_rexx_memory_8hpp.html#a10ca07add5704523d065b7f2d2637f7d">memory_mark</a>(<a class="code" href="class_activity_manager.html#a0cfa9ecefdc20abfe92237d7cdf6c62c">availableActivities</a>);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <a class="code" href="_rexx_memory_8hpp.html#a10ca07add5704523d065b7f2d2637f7d">memory_mark</a>(<a class="code" href="class_activity_manager.html#a1695008449800eabf5aacab6e4ca3ec2">allActivities</a>);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;}</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment"> * Generalized marking of activity manager owned objects.</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment"> * @param reason The marking reason.</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00114"></a><span class="lineno"><a class="line" href="class_activity_manager.html#a9d83248365955974c11dc5722066b655">  114</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_activity_manager.html#a9d83248365955974c11dc5722066b655">ActivityManager::liveGeneral</a>(<a class="code" href="_object_class_8hpp.html#a09453535aa429cceaa131b911d4caa73">MarkReason</a> reason)</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;{</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="comment">// none of these get included in the saved image.  The activity</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="comment">// manager shouldn&#39;t even be getting marked durin the save, but</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="comment">// we make sure for safety.</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="keywordflow">if</span> (reason != <a class="code" href="_object_class_8hpp.html#a09453535aa429cceaa131b911d4caa73a3fc1a0e7009347055cf152f1c3cc72b9">SAVINGIMAGE</a>)</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    {</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <a class="code" href="_rexx_memory_8hpp.html#ad740c29e8223b639f6f3fcbb910ce21a">memory_mark_general</a>(<a class="code" href="class_activity_manager.html#a0cfa9ecefdc20abfe92237d7cdf6c62c">availableActivities</a>);</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <a class="code" href="_rexx_memory_8hpp.html#ad740c29e8223b639f6f3fcbb910ce21a">memory_mark_general</a>(<a class="code" href="class_activity_manager.html#a1695008449800eabf5aacab6e4ca3ec2">allActivities</a>);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    }</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;}</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160; </div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment"> * Add a waiting activity to the waiting queue.</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment"> * @param waitingAct The activity to queue up.</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment"> * @param release    If true, the kernel lock should be released on completion.</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00133"></a><span class="lineno"><a class="line" href="class_activity_manager.html#aff7f8d031752047cc6980dfc2bca603d">  133</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_activity_manager.html#aff7f8d031752047cc6980dfc2bca603d">ActivityManager::addWaitingActivity</a>(<a class="code" href="class_activity.html">Activity</a> *waitingAct, <span class="keywordtype">bool</span> release )</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;{</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <a class="code" href="class_dispatch_section.html">DispatchSection</a> lock;                <span class="comment">// need the dispatch queue lock</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160; </div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordtype">bool</span> inWaitQueue = <span class="keyword">false</span>;            <span class="comment">// used to see if we&#39;re waiting for permission to request the kernel lock</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160; </div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="comment">// nobody waiting yet?  If the release flag is true, we already have the</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="comment">// kernel lock, but nobody is waiting.</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="class_activity_manager.html#a7db2f7d7f13c9c57c76e81af1ebcd1de">hasWaiters</a>())</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    {</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <span class="comment">// we&#39;re done if we already have the lock and the queue is empty.</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="keywordflow">if</span> (release)</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        {</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        }</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    }</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160; </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="comment">// bump our counter so that others know something is waiting</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <a class="code" href="class_activity_manager.html#a6dcf364f11149e8b8ae78c31e86ff460">waitingAccess</a>++;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160; </div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="comment">// if there is something in the queue, remove it and give it permission to run before</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="comment">// we do our stuff.</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160; </div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="comment">// if we are the current kernel semaphore owner, time to release this</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="comment">// so other waiters can get this while we&#39;re setting up</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordflow">if</span> (release)</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    {</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <span class="comment">// release the kernel semaphore and poke the next activity</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <a class="code" href="class_activity_manager.html#a064f7e40095ac35e43214e76dd2c871f">releaseAccess</a>();</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <span class="comment">// we are going to queue up unconditionally and wait in line</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        inWaitQueue = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160; </div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        <span class="comment">// add to the end</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <a class="code" href="class_activity_manager.html#a374af8561e8974a80fb0f976eeeda701">waitingActivities</a>.push_back(waitingAct);</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    }</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="comment">// if there is a current activity, then wait until dispatched.</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_activity_manager.html#a79b68d826eb48037838a9eab89e730fe">currentActivity</a> != <a class="code" href="_rexx_core_8h.html#a181a36438ba4535dd7d22ab63239d1e1">OREF_NULL</a>)</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    {</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        <span class="comment">// we are going to queue up unconditionally and wait in line</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        inWaitQueue = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160; </div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        <span class="comment">// add to the end</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <a class="code" href="class_activity_manager.html#a374af8561e8974a80fb0f976eeeda701">waitingActivities</a>.push_back(waitingAct);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    }</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160; </div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="comment">// we&#39;re going to wait until posted, so make sure the run semaphore is cleared</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="comment">// while we still have the dispatch lock.</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    waitingAct-&gt;<a class="code" href="class_activity.html#a09036ea1d71dbf5e8211477048d451fd">clearRunWait</a>();</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160; </div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="comment">// if we have a recursive reentry while waiting on either semaphore, we&#39;ll need to</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="comment">// know later that this activity is in the dispatch queue so it can be removed from the</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="comment">// queue until the context is unwound.</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    waitingAct-&gt;<a class="code" href="class_activity.html#a766b5fae138d858cace65817bbe02e4f">setWaitingForDispatch</a>();</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160; </div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    lock.<a class="code" href="class_dispatch_section.html#a95d468e85f726b8035498646338ee52d">release</a>();                    <span class="comment">// release the lock now</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160; </div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="comment">// this is a time out indicator</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keywordtype">bool</span> timedOut = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160; </div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="comment">// if we&#39;re in line behind another activity, then wait to get permission to</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="comment">// request the kernel lock.</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordflow">if</span> (inWaitQueue)</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    {</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        <span class="comment">// this willl wait until we are explicitly dispatched or we time out. In either</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        <span class="comment">// case, the real work is done by obtaining the kernel lock. The wait is</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="comment">// primarily so that the different threads operate in more of a round-robin fashion.</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="comment">// The timeout ensures we don&#39;t get a stall condition as can happen sometimes on Windows</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        <span class="comment">// because of how the semaphores are handled.</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        timedOut = waitingAct-&gt;<a class="code" href="class_activity.html#addab59a20b8cc38fc8d9a6715e276d92">waitForDispatch</a>();   <span class="comment">// wait for this thread to get dispatched again</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    }</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    {</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        <span class="comment">// try to yield control so we don&#39;t get into a race condition on</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        <span class="comment">// the kernel semaphore where the same thread keeps getting it over and over</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <span class="comment">// creating the appearance of a hang.</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        waitingAct-&gt;<a class="code" href="class_activity.html#a54ae3894cea6c23b1a497ac1d7c19c3b">yield</a>();</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    }</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160; </div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <a class="code" href="class_activity_manager.html#adb0c7cefcddab6472aafa4cf14d63276">sentinel</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="comment">// depending on situation, it is now a race for the lock, but things have been mixed up</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="comment">// enough that we should be sharing access</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    waitingAct-&gt;<a class="code" href="class_activity.html#ac58f8dacee596f50ddaa42b695e51768">waitForKernel</a>();         <span class="comment">// perform the kernel lock</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <a class="code" href="class_activity_manager.html#adb0c7cefcddab6472aafa4cf14d63276">sentinel</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    lock.<a class="code" href="class_dispatch_section.html#a79d53d4065c167674c799081f525f498">reacquire</a>();                    <span class="comment">// get the resource lock back</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <a class="code" href="class_activity_manager.html#adb0c7cefcddab6472aafa4cf14d63276">sentinel</a> = <span class="keyword">false</span>;                    <span class="comment">// another memory barrier</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160; </div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="comment">// we are no longer waiting to be dispatched.</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    waitingAct-&gt;<a class="code" href="class_activity.html#a0f0c091a0c40049e10a9862f24287cf7">clearWaitingForDispatch</a>();</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160; </div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="comment">// and remove the waiting counter</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <a class="code" href="class_activity_manager.html#a6dcf364f11149e8b8ae78c31e86ff460">waitingAccess</a>--;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160; </div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="comment">// ok, we have the kernel lock and the resource lock. If we did not have a timeout while</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="comment">// waiting for dispatch, then we should still be in the queue and we need to remove our entry.</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="comment">// if we were posted, then the posting thread already removed our entry.</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keywordflow">if</span> (timedOut &amp;&amp; !<a class="code" href="class_activity_manager.html#a374af8561e8974a80fb0f976eeeda701">waitingActivities</a>.empty())</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    {</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        <span class="comment">// search for the activity position and remove it.</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        <span class="keywordflow">for</span> (std::deque&lt;Activity *&gt;::iterator it = <a class="code" href="class_activity_manager.html#a374af8561e8974a80fb0f976eeeda701">waitingActivities</a>.begin(); it != <a class="code" href="class_activity_manager.html#a374af8561e8974a80fb0f976eeeda701">waitingActivities</a>.end(); ++it)</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        {</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            <span class="comment">// if this is found, remove it from the queue</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            <span class="keywordflow">if</span> (*it == waitingAct)</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;            {</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                <a class="code" href="class_activity_manager.html#a374af8561e8974a80fb0f976eeeda701">waitingActivities</a>.erase(it);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            }</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        }</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        <span class="comment">// ignore this if not found.</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    }</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160; </div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="comment">// the setting of the sentinel variables acts as a memory barrier to</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="comment">// ensure that the assignment of currentActivitiy occurs precisely at this point.</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <a class="code" href="class_activity_manager.html#adb0c7cefcddab6472aafa4cf14d63276">sentinel</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    waitingAct-&gt;<a class="code" href="class_activity.html#aac136d1ebecd3672d123fe9aa9642c70">setupCurrentActivity</a>();</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;}</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160; </div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment"> * Add a waiting activity to the waiting queue. This is done</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment"> * with priority access with no dispatch wait so that external</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment"> * callbacks can behave quickly in highly concurrent</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment"> * environments.</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment"> * @param waitingAct The activity to queue up.</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00258"></a><span class="lineno"><a class="line" href="class_activity_manager.html#a57a2ec058a1772ac839aa0e7654e4041">  258</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_activity_manager.html#a57a2ec058a1772ac839aa0e7654e4041">ActivityManager::addWaitingApiActivity</a>(<a class="code" href="class_activity.html">Activity</a> *waitingAct)</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;{</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <a class="code" href="class_dispatch_section.html">DispatchSection</a> lock;                <span class="comment">// need the dispatch queue lock</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160; </div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <a class="code" href="class_activity_manager.html#a6dcf364f11149e8b8ae78c31e86ff460">waitingAccess</a>++;                     <span class="comment">// indicate that we are waiting for access</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <a class="code" href="class_activity_manager.html#a3ae96cdf24c0cecc1074df9e60b4478c">waitingApiAccess</a>++;                  <span class="comment">// indicate that we are waiting on behalf of an API call.</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160; </div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="comment">// if we have a recursive reentry while waiting on either semaphore, we&#39;ll need to</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="comment">// know later that this activity is in the dispatch queue so it can be removed from the</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="comment">// queue until the context is unwound.</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    waitingAct-&gt;<a class="code" href="class_activity.html#a766b5fae138d858cace65817bbe02e4f">setWaitingForDispatch</a>();</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160; </div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="comment">// if we have a lock holder currently, ask the RexxActivation to yield immediately.</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="comment">// make sure we call this AFTER incrementing waitingApiAccess so the activation knows</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="comment">// to yield without checking the timestamp.</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <a class="code" href="class_activity_manager.html#a021516beb284d95badb7953264601514">yieldCurrentActivity</a>();</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160; </div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    lock.<a class="code" href="class_dispatch_section.html#a95d468e85f726b8035498646338ee52d">release</a>();                    <span class="comment">// release the lock now</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160; </div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <a class="code" href="class_activity_manager.html#adb0c7cefcddab6472aafa4cf14d63276">sentinel</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="comment">// in theory, we should now be the only activity waiting on the kernel lock</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    waitingAct-&gt;<a class="code" href="class_activity.html#ac58f8dacee596f50ddaa42b695e51768">waitForKernel</a>();         <span class="comment">// perform the kernel lock</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <a class="code" href="class_activity_manager.html#adb0c7cefcddab6472aafa4cf14d63276">sentinel</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    lock.<a class="code" href="class_dispatch_section.html#a79d53d4065c167674c799081f525f498">reacquire</a>();                    <span class="comment">// get the resource lock back</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <a class="code" href="class_activity_manager.html#adb0c7cefcddab6472aafa4cf14d63276">sentinel</a> = <span class="keyword">false</span>;                    <span class="comment">// another memory barrier</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160; </div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="comment">// we are no longer waiting to be dispatched.</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    waitingAct-&gt;<a class="code" href="class_activity.html#a0f0c091a0c40049e10a9862f24287cf7">clearWaitingForDispatch</a>();</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160; </div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="comment">// and remove the waiting counters</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <a class="code" href="class_activity_manager.html#a3ae96cdf24c0cecc1074df9e60b4478c">waitingApiAccess</a>--;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <a class="code" href="class_activity_manager.html#a6dcf364f11149e8b8ae78c31e86ff460">waitingAccess</a>--;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160; </div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="comment">// now that we have the kernel lock, dispatch another waiter</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="comment">// to make sure the pipeline is always active.</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <a class="code" href="class_activity_manager.html#ae690a4e2ac463f50d4377a1f385aec64">dispatchNext</a>();</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160; </div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="comment">// the setting of the sentinel variables acts as a memory barrier to</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="comment">// ensure that the assignment of currentActivitiy occurs precisely at this point.</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <a class="code" href="class_activity_manager.html#adb0c7cefcddab6472aafa4cf14d63276">sentinel</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    waitingAct-&gt;<a class="code" href="class_activity.html#aac136d1ebecd3672d123fe9aa9642c70">setupCurrentActivity</a>();</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;}</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160; </div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment"> * Find an activity in the queue that is waiting for run permission</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment"> * and free it up for execution. Elements in the waitingActivities</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment"> * queue can be in different places in the dispatch process and we</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment"> * don&#39;t want to get things held up because an activity might not</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment"> * be able to obtain the lock immediately.</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment"> * @return true if an item was dispatched, false if nothing was dispatched.</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00311"></a><span class="lineno"><a class="line" href="class_activity_manager.html#ae690a4e2ac463f50d4377a1f385aec64">  311</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_activity_manager.html#ae690a4e2ac463f50d4377a1f385aec64">ActivityManager::dispatchNext</a>()</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;{</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="comment">// run the dispatch queue looking for a non-posted activity and</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="comment">// remove any that have already been posted.</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="keywordflow">while</span> (!<a class="code" href="class_activity_manager.html#a374af8561e8974a80fb0f976eeeda701">waitingActivities</a>.empty())</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    {</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        <span class="comment">// look for the first activity that has not had its semaphore posted yet and post it.</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <a class="code" href="class_activity.html">Activity</a> *activity = <a class="code" href="class_activity_manager.html#a374af8561e8974a80fb0f976eeeda701">waitingActivities</a>.front();</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        <span class="comment">// we&#39;re going to remove this in either case, so pop it off now.</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <a class="code" href="class_activity_manager.html#a374af8561e8974a80fb0f976eeeda701">waitingActivities</a>.pop_front();</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160; </div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        <span class="comment">// if this has not been posted yet, post now and return.</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <span class="comment">// there are some situations where a NULL ends up in the queue, so</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        <span class="comment">// just ignore those and keep looking</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        <span class="keywordflow">if</span> (activity != <a class="code" href="_rexx_core_8h.html#a181a36438ba4535dd7d22ab63239d1e1">OREF_NULL</a> &amp;&amp; !activity-&gt;<a class="code" href="class_activity.html#acbd9182699d31f0497e0533e5f7f4e9a">hasRunPermission</a>())</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        {</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            activity-&gt;<a class="code" href="class_activity.html#afcaa9e814b1d80f36d3fdb7f3622d598">postDispatch</a>();</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        }</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    }</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="comment">// nothing dispatched</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;}</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160; </div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160; </div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment"> * return a nested waiting activity to the waiting queue.</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment"> * @param waitingAct The activity to queue up.</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00342"></a><span class="lineno"><a class="line" href="class_activity_manager.html#a0963e9c66056b234c20765b29e5f1fae">  342</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_activity_manager.html#a0963e9c66056b234c20765b29e5f1fae">ActivityManager::returnWaitingActivity</a>(<a class="code" href="class_activity.html">Activity</a> *waitingAct)</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;{</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <a class="code" href="class_dispatch_section.html">DispatchSection</a> lock;                <span class="comment">// need the dispatch queue lock</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160; </div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <a class="code" href="class_activity_manager.html#a6dcf364f11149e8b8ae78c31e86ff460">waitingAccess</a>++;                     <span class="comment">// this one is back</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="comment">// this could be waiting because it is an API call back.</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="comment">// we need to bump the counter for that as well.</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="keywordflow">if</span> (waitingAct-&gt;<a class="code" href="class_activity.html#a3aeb1bab5ea6b4aeccc8de8446ce037c">isWaitingForApiAccess</a>())</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    {</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        <a class="code" href="class_activity_manager.html#a3ae96cdf24c0cecc1074df9e60b4478c">waitingApiAccess</a>++;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    }</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160; </div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="comment">// because this was suspended while waiting for a semaphore, we&#39;ll just post</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="comment">// the run dispatch semaphore now and allow it to try to get the kernel lock</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="comment">// when control unwinds to that point.</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    waitingAct-&gt;<a class="code" href="class_activity.html#afcaa9e814b1d80f36d3fdb7f3622d598">postDispatch</a>();</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;}</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160; </div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment"> * Terminate an interpreter instance.  This starts process</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment"> * shutdown if the last instance goes away.</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00365"></a><span class="lineno"><a class="line" href="class_activity_manager.html#a21b555fe8b75e3ba7854dd3c2e016b51">  365</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_activity_manager.html#a21b555fe8b75e3ba7854dd3c2e016b51">ActivityManager::createInterpreter</a>()</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;{</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <a class="code" href="class_activity_manager.html#a49aa623a244c04ab727e9d421ac5ebcd">interpreterInstances</a>++;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;}</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment"> * Terminate an interpreter instance.  This starts process</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment"> * shutdown if the last instance goes away.</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00374"></a><span class="lineno"><a class="line" href="class_activity_manager.html#aa6584f2cc0d15c4a03d8999e079cdd30">  374</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_activity_manager.html#aa6584f2cc0d15c4a03d8999e079cdd30">ActivityManager::terminateInterpreter</a>()</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;{</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <a class="code" href="class_resource_section.html">ResourceSection</a> lock;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160; </div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="comment">// if this is the last interpreter instance, then shutdown</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="comment">// the entire environment.</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <a class="code" href="class_activity_manager.html#a49aa623a244c04ab727e9d421ac5ebcd">interpreterInstances</a>--;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="class_activity_manager.html#a49aa623a244c04ab727e9d421ac5ebcd">interpreterInstances</a> == 0)</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    {</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        <a class="code" href="class_activity_manager.html#a9068817dc272f1346efebf50a437a250">shutdown</a>();</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    }</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;}</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160; </div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment"> * Shutdown the activity manager and initiate interpreter termination.</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00391"></a><span class="lineno"><a class="line" href="class_activity_manager.html#a9068817dc272f1346efebf50a437a250">  391</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_activity_manager.html#a9068817dc272f1346efebf50a437a250">ActivityManager::shutdown</a>()</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;{</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <a class="code" href="class_activity_manager.html#a0083bef91fb6b8a26f8738b7bfb9e24a">processTerminating</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160; </div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="comment">// Go clean up all of the pooled activities.</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <a class="code" href="class_activity_manager.html#a1f895528d5ed0f44c92d597c72f6f55a">clearActivityPool</a>();</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;}</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160; </div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="comment"> * Create a new activation for a toplevel activation using a</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="comment"> * routine (vs. a method invocation).</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment"> * @param activity The activity we&#39;re running on.</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment"> * @param routine  The routine object we&#39;re calling.</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment"> * @param code     The code object associated with the method.</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment"> * @param calltype The type of call being made.</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment"> * @param environment</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment"> *                 The initial address environment.</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment"> * @param context  The context of the invocation.</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment"> * @return The newly created activation.</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00414"></a><span class="lineno"><a class="line" href="class_activity_manager.html#a8461af3774422faea23d0d0e34d3d388">  414</a></span>&#160;<a class="code" href="class_rexx_activation.html">RexxActivation</a> *<a class="code" href="class_activity_manager.html#a8461af3774422faea23d0d0e34d3d388">ActivityManager::newActivation</a>(<a class="code" href="class_activity.html">Activity</a> *activity, <a class="code" href="class_routine_class.html">RoutineClass</a> *routine, <a class="code" href="class_rexx_code.html">RexxCode</a> *code, <a class="code" href="class_rexx_string.html">RexxString</a> *calltype, <a class="code" href="class_rexx_string.html">RexxString</a> *environment, <a class="code" href="_activation_settings_8hpp.html#a927998540344942bf3382d87499acce7">ActivationContext</a> context)</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;{</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="comment">// in heavily multithreaded environments, the activation cache is a source for race conditions</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <span class="comment">// that can lead to crashes.  Just unconditionally create a new actvation</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="class_rexx_activation.html">RexxActivation</a>(activity, routine, code, calltype, environment, context);</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;}</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160; </div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment"> * Create a new activation for an internal level call</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment"> * (internal call or interpreted execution).</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment"> * @param activity The activity we&#39;re running on.</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment"> * @param parent   The parent activation.  OREF_NULL is used if this is a top-level</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment"> *                 call.</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment"> * @param code     The code object associated with the method.</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment"> * @param context  The context of the invocation.</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment"> * @return The newly created activation.</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00434"></a><span class="lineno"><a class="line" href="class_activity_manager.html#a33516bf056a243be6bb0b8072ca521d6">  434</a></span>&#160;<a class="code" href="class_rexx_activation.html">RexxActivation</a> *<a class="code" href="class_activity_manager.html#a8461af3774422faea23d0d0e34d3d388">ActivityManager::newActivation</a>(<a class="code" href="class_activity.html">Activity</a> *activity, <a class="code" href="class_rexx_activation.html">RexxActivation</a> *parent, <a class="code" href="class_rexx_code.html">RexxCode</a> *code, <a class="code" href="_activation_settings_8hpp.html#a927998540344942bf3382d87499acce7">ActivationContext</a> context)</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;{</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="comment">// in heavily multithreaded environments, the activation cache is a source for race conditions</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="comment">// that can lead to crashes.  Just unconditionally create a new actvation</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="class_rexx_activation.html">RexxActivation</a>(activity, parent, code, context);</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;}</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160; </div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment"> * Create a new activation for a method invocation (vs. a</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment"> * program or routine call)</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="comment"> * @param activity The activity we&#39;re running on.</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="comment"> * @param method   The method object being invoked.</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment"> * @param code     The code object associated with the method.</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment"> * @return The newly created activation.</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00452"></a><span class="lineno"><a class="line" href="class_activity_manager.html#a174b112685cab558faa482d5e6699502">  452</a></span>&#160;<a class="code" href="class_rexx_activation.html">RexxActivation</a> *<a class="code" href="class_activity_manager.html#a8461af3774422faea23d0d0e34d3d388">ActivityManager::newActivation</a>(<a class="code" href="class_activity.html">Activity</a> *activity, <a class="code" href="class_method_class.html">MethodClass</a> *method, <a class="code" href="class_rexx_code.html">RexxCode</a> *code)</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;{</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <span class="comment">// in heavily multithreaded environments, the activation cache is a source for race conditions</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="comment">// that can lead to crashes.  Just unconditionally create a new actvation</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="class_rexx_activation.html">RexxActivation</a>(activity, method, code);</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;}</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160; </div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment"> * Create a new activation for a a native external call stack</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment"> * @param activity The activity we&#39;re running on.</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment"> * @param parent   The parent activation.</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment"> * @return The newly created activation.</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00468"></a><span class="lineno"><a class="line" href="class_activity_manager.html#a1e666f0a1ab4359d08c6b72c531b6345">  468</a></span>&#160;<a class="code" href="class_native_activation.html">NativeActivation</a> *<a class="code" href="class_activity_manager.html#a1e666f0a1ab4359d08c6b72c531b6345">ActivityManager::newNativeActivation</a>(<a class="code" href="class_activity.html">Activity</a> *activity, <a class="code" href="class_rexx_activation.html">RexxActivation</a> *parent)</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;{</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="comment">// in heavily multithreaded environments, the activation cache is a source for race conditions</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="comment">// that can lead to crashes.  Just unconditionally create a new actvation</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="class_native_activation.html">NativeActivation</a>(activity, parent);</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;}</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160; </div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment"> * Create a new activation for a a native external call stack</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="comment"> * @param activity The activity we&#39;re running on.</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="comment"> * @return The newly created activation.</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00483"></a><span class="lineno"><a class="line" href="class_activity_manager.html#a1cf0bb03d4bdc276e6d8a55f1a38004d">  483</a></span>&#160;<a class="code" href="class_native_activation.html">NativeActivation</a> *<a class="code" href="class_activity_manager.html#a1e666f0a1ab4359d08c6b72c531b6345">ActivityManager::newNativeActivation</a>(<a class="code" href="class_activity.html">Activity</a> *activity)</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;{</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="comment">// in heavily multithreaded environments, the activation cache is a source for race conditions</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="comment">// that can lead to crashes.  Just unconditionally create a new actvation</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="class_native_activation.html">NativeActivation</a>(activity);</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;}</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160; </div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="comment"> * Obtain a new activity for running on a separate thread.</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment"> * @return The created (or pooled) activity object.</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00496"></a><span class="lineno"><a class="line" href="class_activity_manager.html#a80d7fbc18e694eb0cc49773a6a67c615">  496</a></span>&#160;<a class="code" href="class_activity.html">Activity</a>* <a class="code" href="class_activity_manager.html#a80d7fbc18e694eb0cc49773a6a67c615">ActivityManager::createNewActivity</a>()</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;{</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <a class="code" href="class_resource_section.html">ResourceSection</a> lock;                <span class="comment">// lock the control information</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="comment">// we need to protect the new Activity from garbage collection while constructing.</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="comment">// unfortunately, we can&#39;t use ProtectedObject because that requires an</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <span class="comment">// active activity, which we can&#39;t guarantee at this point.</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <a class="code" href="class_global_protected_object.html">GlobalProtectedObject</a> p;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160; </div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="comment">// try to get an activity from the cache</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <a class="code" href="class_activity.html">Activity</a> *activity =  (<a class="code" href="class_activity.html">Activity</a> *)<a class="code" href="class_activity_manager.html#a0cfa9ecefdc20abfe92237d7cdf6c62c">availableActivities</a>-&gt;<a class="code" href="class_queue_class.html#abe80204f0e5173f7f58d64179494a8a7">pull</a>();</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <span class="keywordflow">if</span> (activity == <a class="code" href="_rexx_core_8h.html#a181a36438ba4535dd7d22ab63239d1e1">OREF_NULL</a>)</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    {</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        <span class="comment">// we release the resource lock around creating</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        <span class="comment">// a new activation</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        lock.<a class="code" href="class_resource_section.html#a40efe610cb235621ddb0483b1f008c47">release</a>();</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        activity = <span class="keyword">new</span> <a class="code" href="class_activity.html">Activity</a>(p, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        lock.<a class="code" href="class_resource_section.html#ac598d3b93ac1b6aac6d33482fc38e05d">reacquire</a>();</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        <span class="comment">// add this to our table of all activities</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        <a class="code" href="class_activity_manager.html#a1695008449800eabf5aacab6e4ca3ec2">allActivities</a>-&gt;<a class="code" href="class_array_class.html#a0bcebe7be61cb31bd6dffff3f65dfb91">append</a>(activity);</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    }</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    {</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        <span class="comment">// We are able to reuse an activity, so just re-initialize it.</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        activity-&gt;<a class="code" href="class_activity.html#ac2a5f9935f15452d9d8bf131e59bc7bd">reset</a>();</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    }</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="keywordflow">return</span> activity;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;}</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160; </div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="comment"> * Create an activity object for the current thread.</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="comment"> * @return</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00530"></a><span class="lineno"><a class="line" href="class_activity_manager.html#ad6803dcbd0b41129f3e5a95b101f9868">  530</a></span>&#160;<a class="code" href="class_activity.html">Activity</a> *<a class="code" href="class_activity_manager.html#ad6803dcbd0b41129f3e5a95b101f9868">ActivityManager::createCurrentActivity</a>()</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;{</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="comment">// we need to protect the new Activity from garbage collection while constructing.</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="comment">// unfortunately, we can&#39;t use ProtectedObject because that requires an</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <span class="comment">// active activity, which we can&#39;t guarantee at this point.</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <a class="code" href="class_global_protected_object.html">GlobalProtectedObject</a> p;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160; </div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="comment">// create an activity object without creating a new thread</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <a class="code" href="class_activity.html">Activity</a> *activity = <span class="keyword">new</span> <a class="code" href="class_activity.html">Activity</a>(p, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="comment">// we need the resource lock while doing this.</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <a class="code" href="class_resource_section.html">ResourceSection</a> lock;</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="comment">// add this to the activity table and return</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <a class="code" href="class_activity_manager.html#a1695008449800eabf5aacab6e4ca3ec2">allActivities</a>-&gt;<a class="code" href="class_array_class.html#a0bcebe7be61cb31bd6dffff3f65dfb91">append</a>(activity);</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <span class="keywordflow">return</span> activity;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;}</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160; </div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="comment"> * Clone off an activity from an existing activity.  Used for</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="comment"> * message start() are early reply operations.</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="comment"> * @param parent The currently running activity.  The activity-specific settings are</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="comment"> *               inherited from the parent.</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="comment"> * @return A new activity.</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00556"></a><span class="lineno"><a class="line" href="class_activity_manager.html#ad96044dc588d2c9830320fd4041b1c39">  556</a></span>&#160;<a class="code" href="class_activity.html">Activity</a> *<a class="code" href="class_activity_manager.html#a80d7fbc18e694eb0cc49773a6a67c615">ActivityManager::createNewActivity</a>(<a class="code" href="class_activity.html">Activity</a> *parent)</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;{</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="comment">// create a new activity with the same priority as the parent</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <a class="code" href="class_activity.html">Activity</a> *activity = <a class="code" href="class_activity_manager.html#a80d7fbc18e694eb0cc49773a6a67c615">createNewActivity</a>();</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="comment">// copy any needed settings from the parent</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    activity-&gt;<a class="code" href="class_activity.html#afd9236a307a080a4d97139c344117fac">inheritSettings</a>(parent);</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <span class="keywordflow">return</span> activity;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;}</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160; </div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="comment"> * Clear the activty pool of pooled activities.</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00569"></a><span class="lineno"><a class="line" href="class_activity_manager.html#a1f895528d5ed0f44c92d597c72f6f55a">  569</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_activity_manager.html#a1f895528d5ed0f44c92d597c72f6f55a">ActivityManager::clearActivityPool</a>()</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;{</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <a class="code" href="class_resource_section.html">ResourceSection</a> lock;                <span class="comment">// critical section, protect interaction with activity queues</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160; </div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <a class="code" href="class_activity.html">Activity</a> *activity = (<a class="code" href="class_activity.html">Activity</a> *)<a class="code" href="class_activity_manager.html#a0cfa9ecefdc20abfe92237d7cdf6c62c">availableActivities</a>-&gt;<a class="code" href="class_queue_class.html#abe80204f0e5173f7f58d64179494a8a7">pull</a>();</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="keywordflow">while</span> (activity != <a class="code" href="_rexx_core_8h.html#a181a36438ba4535dd7d22ab63239d1e1">OREF_NULL</a>)</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    {</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        <span class="comment">// terminate this thread</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        activity-&gt;<a class="code" href="class_activity.html#ab2ea2b8ea22e4817f5561c8265dad491">terminatePoolActivity</a>();</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        activity = (<a class="code" href="class_activity.html">Activity</a> *)<a class="code" href="class_activity_manager.html#a0cfa9ecefdc20abfe92237d7cdf6c62c">availableActivities</a>-&gt;<a class="code" href="class_queue_class.html#abe80204f0e5173f7f58d64179494a8a7">pull</a>();</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    }</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;}</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160; </div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="comment"> * Return an activity to the available pool.  If we&#39;re in the</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="comment"> * process of shutting down, or have too many pool activities,</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="comment"> * we&#39;ll return false to tell the activity to completely</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;<span class="comment"> * shut things down.</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="comment"> * @param activity The activity we&#39;re adding back to the available pool.</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="comment"> * @return true if this was pooled, false if the thread should not wait for</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="comment"> *         more work.</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00594"></a><span class="lineno"><a class="line" href="class_activity_manager.html#a1290ffb98f94914ac24bfd7dc858b5c1">  594</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_activity_manager.html#a1290ffb98f94914ac24bfd7dc858b5c1">ActivityManager::poolActivity</a>(<a class="code" href="class_activity.html">Activity</a> *activity)</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;{</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <span class="comment">// ResourceSection lock held by caller: bool InterpreterInstance::poolActivity(Activity *activity</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160; </div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="comment">// are we shutting down or have too many threads in the pool?</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="class_activity_manager.html#a0083bef91fb6b8a26f8738b7bfb9e24a">processTerminating</a> || <a class="code" href="class_activity_manager.html#a0cfa9ecefdc20abfe92237d7cdf6c62c">availableActivities</a>-&gt;<a class="code" href="class_array_class.html#aa4e0c86824aaec36a0e8197c37a86c60">items</a>() &gt; <a class="code" href="class_activity_manager.html#a035de91a5aff30fa3301451b20861143">MAX_THREAD_POOL_SIZE</a>)</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    {</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        <span class="comment">// have the activity clean up its resources.</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        activity-&gt;<a class="code" href="class_activity.html#a3f0935db9cb7cff9c8ec267944bf213a">cleanupActivityResources</a>();</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160; </div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        <span class="comment">// remove this from the activity list</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        <a class="code" href="class_activity_manager.html#a1695008449800eabf5aacab6e4ca3ec2">allActivities</a>-&gt;<a class="code" href="class_array_class.html#a9b1bdaa3efbb8fc70487082c6968ab9a">removeItem</a>(activity);</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    }</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    {</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        <span class="comment">// just add this to the available list</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        <a class="code" href="class_activity_manager.html#a0cfa9ecefdc20abfe92237d7cdf6c62c">availableActivities</a>-&gt;<a class="code" href="class_array_class.html#a0bcebe7be61cb31bd6dffff3f65dfb91">append</a>(activity);</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;   <span class="comment">// this was successfully pooled</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    }</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;}</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160; </div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="comment"> * Raise a halt condition on an activity.</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="comment"> * @param thread_id The target thread identifier.</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="comment"> * @param description</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="comment"> *                  The description of the halt.</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="comment"> * @return Returns the halt result.  Returns false if a halt</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="comment"> *         condition is already pending or the target activity</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="comment"> *         is not found.</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00628"></a><span class="lineno"><a class="line" href="class_activity_manager.html#ab1db9333ee59809f09fac653510bcffa">  628</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_activity_manager.html#ab1db9333ee59809f09fac653510bcffa">ActivityManager::haltActivity</a>(<a class="code" href="unix_2rexxapitypes_8h.html#ad16be474ba962961346dd85d95385de9">thread_id_t</a>  thread_id, <a class="code" href="class_rexx_string.html">RexxString</a> * description )</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;{</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <a class="code" href="class_resource_section.html">ResourceSection</a> lock;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <span class="comment">// locate the activity associated with this thread_id.  If not found, return</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="comment">// a failure.</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <a class="code" href="class_activity.html">Activity</a> *activity = <a class="code" href="class_activity_manager.html#ae62aa7eb85ba887e9351fef8886b7678">findActivity</a>(thread_id);</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    <span class="keywordflow">if</span> (activity != <a class="code" href="_rexx_core_8h.html#a181a36438ba4535dd7d22ab63239d1e1">OREF_NULL</a>)</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    {</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        <span class="keywordflow">return</span> activity-&gt;<a class="code" href="class_activity.html#aebcd5f73a74aff6334327eddbef1f802">halt</a>(description);</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    }</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;                        <span class="comment">// this was a failure</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;}</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160; </div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="comment"> * Flip on external trace for a thread.</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="comment"> * @param thread_id The target thread id.</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="comment"> * @param on_or_off The trace setting.</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="comment"> * @return true if this worked, false otherwise.</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00650"></a><span class="lineno"><a class="line" href="class_activity_manager.html#a0b6a875441a4e8f864c70fb39a41272f">  650</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_activity_manager.html#a0b6a875441a4e8f864c70fb39a41272f">ActivityManager::setActivityTrace</a>(<a class="code" href="unix_2rexxapitypes_8h.html#ad16be474ba962961346dd85d95385de9">thread_id_t</a> thread_id, <span class="keywordtype">bool</span>  on_or_off )</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;{</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <a class="code" href="class_resource_section.html">ResourceSection</a> lock;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <span class="comment">// locate the activity associated with this thread_id.  If not found, return</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <span class="comment">// a failure.</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <a class="code" href="class_activity.html">Activity</a> *activity = <a class="code" href="class_activity_manager.html#ae62aa7eb85ba887e9351fef8886b7678">findActivity</a>(thread_id);</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    <span class="keywordflow">if</span> (activity != <a class="code" href="_rexx_core_8h.html#a181a36438ba4535dd7d22ab63239d1e1">OREF_NULL</a>)</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    {</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        <span class="keywordflow">return</span> activity-&gt;<a class="code" href="class_activity.html#ad3d2e4220ba7c5e34ab88a306d6f0e92">setTrace</a>(on_or_off);</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    }</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;                        <span class="comment">// this was a failure</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;}</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160; </div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="comment"> * Signal an activation to yield control</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00667"></a><span class="lineno"><a class="line" href="class_activity_manager.html#a021516beb284d95badb7953264601514">  667</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_activity_manager.html#a021516beb284d95badb7953264601514">ActivityManager::yieldCurrentActivity</a>()</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;{</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <a class="code" href="class_activity.html">Activity</a> *activity = <a class="code" href="class_activity_manager.html#a79b68d826eb48037838a9eab89e730fe">ActivityManager::currentActivity</a>;</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    <span class="keywordflow">if</span> (activity != <a class="code" href="_rexx_core_8h.html#a181a36438ba4535dd7d22ab63239d1e1">OREF_NULL</a>)</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    {</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        activity-&gt;<a class="code" href="class_activity.html#a54ae3894cea6c23b1a497ac1d7c19c3b">yield</a>();</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    }</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;}</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160; </div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<span class="comment"> * Locate the activity associated with a thread</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="comment"> * @param threadId The target thread id</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="comment"> * @return The activity, or OREF_NULL if this is not currently in use.</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00684"></a><span class="lineno"><a class="line" href="class_activity_manager.html#a110dabf298eb00e220acc58ed28e8e3d">  684</a></span>&#160;<a class="code" href="class_activity.html">Activity</a> *<a class="code" href="class_activity_manager.html#ae62aa7eb85ba887e9351fef8886b7678">ActivityManager::findActivity</a>(<a class="code" href="unix_2rexxapitypes_8h.html#ad16be474ba962961346dd85d95385de9">thread_id_t</a> threadId)</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;{</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <span class="comment">// this is a critical section</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <a class="code" href="class_resource_section.html">ResourceSection</a> lock;</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160; </div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <span class="comment">// NB:  New activities are pushed on to the end, so it&#39;s prudent to search</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <span class="comment">// from the list end toward the front of the list.  Also, this ensures we</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <span class="comment">// will find the toplevel activity nested on a given thread first.</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> listIndex = <a class="code" href="class_activity_manager.html#a1695008449800eabf5aacab6e4ca3ec2">allActivities</a>-&gt;<a class="code" href="class_array_class.html#acc163bec438db906081313190032dcdc">lastIndex</a>(); listIndex &gt; 0; listIndex--)</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    {</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;        <a class="code" href="class_activity.html">Activity</a> *activity = (<a class="code" href="class_activity.html">Activity</a> *)<a class="code" href="class_activity_manager.html#a1695008449800eabf5aacab6e4ca3ec2">allActivities</a>-&gt;<a class="code" href="class_array_class.html#ac9ff63dbacda2000a4f783568b5428f2">get</a>(listIndex);</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        <span class="comment">// this should never happen, but we never return suspended threads</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        <span class="keywordflow">if</span> (activity-&gt;<a class="code" href="class_activity.html#a934a011d93bb8fefdff7300b14da8f21">isThread</a>(threadId) &amp;&amp; !activity-&gt;<a class="code" href="class_activity.html#a59c0b74c4d3989daa393d211792d4383">isSuspended</a>())</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        {</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;            <span class="keywordflow">return</span> activity;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        }</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    }</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="_rexx_core_8h.html#a181a36438ba4535dd7d22ab63239d1e1">OREF_NULL</a>;</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;}</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160; </div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="comment"> * Locate the activity associated with the current thread</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;<span class="comment"> * @return The Activity for this thread, if it exists.</span></div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00710"></a><span class="lineno"><a class="line" href="class_activity_manager.html#ae62aa7eb85ba887e9351fef8886b7678">  710</a></span>&#160;<a class="code" href="class_activity.html">Activity</a> *<a class="code" href="class_activity_manager.html#ae62aa7eb85ba887e9351fef8886b7678">ActivityManager::findActivity</a>()</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;{</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_activity_manager.html#ae62aa7eb85ba887e9351fef8886b7678">findActivity</a>(<a class="code" href="class_sys_activity.html#a3710e2ade99fbb283200ad60398e8e1c">SysActivity::queryThreadID</a>());</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;}</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160; </div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;<span class="comment"> * Really shut down--this exits the process</span></div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="comment"> * @param retcode The exit return code.</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00721"></a><span class="lineno"><a class="line" href="class_activity_manager.html#abd3e40501c41cb34177d3544f0c4a817">  721</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_activity_manager.html#abd3e40501c41cb34177d3544f0c4a817">ActivityManager::exit</a>(<span class="keywordtype">int</span> retcode)</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;{</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;   <a class="code" href="class_activity_manager.html#abd3e40501c41cb34177d3544f0c4a817">::exit</a>(retcode);</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;}</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160; </div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<span class="comment"> * release the kernel access and make sure waiting activites are woken up.</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00730"></a><span class="lineno"><a class="line" href="class_activity_manager.html#a064f7e40095ac35e43214e76dd2c871f">  730</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_activity_manager.html#a064f7e40095ac35e43214e76dd2c871f">ActivityManager::releaseAccess</a>()</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;{</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    <a class="code" href="class_dispatch_section.html">DispatchSection</a> lock;                <span class="comment">// need the dispatch queue lock</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160; </div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="comment">// since we&#39;re releasing the semaphore, give any queued activities a nudge</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    <span class="comment">// forward in the request process.</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <a class="code" href="class_activity_manager.html#ae690a4e2ac463f50d4377a1f385aec64">dispatchNext</a>();</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160; </div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    <span class="comment">// now release the kernel lock</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    <a class="code" href="class_activity_manager.html#acd99df1a0ccfc7e0cd21e6595a0b13ee">unlockKernel</a>();</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;}</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160; </div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="comment"> * Create the global kernel lock for the ActivityManager.</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00746"></a><span class="lineno"><a class="line" href="class_activity_manager.html#ab05bff78507794d1cd7753c5b2d188c1">  746</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_activity_manager.html#ab05bff78507794d1cd7753c5b2d188c1">ActivityManager::createLocks</a>()</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;{</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <a class="code" href="class_activity_manager.html#ac4eda8b811909cca248959db37e5834e">kernelSemaphore</a>.<a class="code" href="class_sys_mutex.html#a706d2372b863a8f06ddc94aeac6a7b3a">create</a>();</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    <span class="comment">// this needs to be created and set</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    <a class="code" href="class_activity_manager.html#a01366e1f82be7ff807af6e69d1f09080">terminationSem</a>.<a class="code" href="class_sys_semaphore.html#a7d0f7344b9320094fbcec9bf4a20bb51">create</a>();</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <a class="code" href="class_activity_manager.html#a01366e1f82be7ff807af6e69d1f09080">terminationSem</a>.<a class="code" href="class_sys_semaphore.html#ab9723befb919f4bccf928829c966ce2c">reset</a>();</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;}</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160; </div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="comment"> * Cleanup the global locks for the ActivityManager.</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00758"></a><span class="lineno"><a class="line" href="class_activity_manager.html#ac5de661ac9df39905bcf382ac7e7089f">  758</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_activity_manager.html#ac5de661ac9df39905bcf382ac7e7089f">ActivityManager::closeLocks</a>()</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;{</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    <a class="code" href="class_activity_manager.html#ac4eda8b811909cca248959db37e5834e">kernelSemaphore</a>.<a class="code" href="class_sys_mutex.html#a2ccac2bd5f877849c676647d61d2e878">close</a>();</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <a class="code" href="class_activity_manager.html#a01366e1f82be7ff807af6e69d1f09080">terminationSem</a>.<a class="code" href="class_sys_semaphore.html#a93cb3437378cdc63a5c6a3f00de88d7e">close</a>();</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;}</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160; </div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;<span class="comment"> * Try a fast request for the kernel.  This requires A) there</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;<span class="comment"> * be no waiting activities and B) that it be possible to request</span></div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;<span class="comment"> * the semaphore without waiting.</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;<span class="comment"> * @return true if the semaphore was obtained, false if the kernel is</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;<span class="comment"> *         not locked by this activity.</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00773"></a><span class="lineno"><a class="line" href="class_activity_manager.html#a559621dc7d57535d6c7bb0ccc9de7a01">  773</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_activity_manager.html#a559621dc7d57535d6c7bb0ccc9de7a01">ActivityManager::lockKernelImmediate</a>()</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;{</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    <span class="comment">// don&#39;t give this up if we have activities in the</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    <span class="comment">// dispatch queue</span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="class_activity_manager.html#a7db2f7d7f13c9c57c76e81af1ebcd1de">hasWaiters</a>())</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    {</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="class_activity_manager.html#ac4eda8b811909cca248959db37e5834e">kernelSemaphore</a>.<a class="code" href="class_sys_mutex.html#a724aa1df1c40901fbe232e235ec27cee">requestImmediate</a>();</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    }</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;}</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160; </div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;<span class="comment"> * Return an activity to the activity pool.</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;<span class="comment"> * @param activityObject</span></div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;<span class="comment"> *               The released activity.</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00791"></a><span class="lineno"><a class="line" href="class_activity_manager.html#ad1ee85752776416adf790ec6f39f5af8">  791</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_activity_manager.html#ad1ee85752776416adf790ec6f39f5af8">ActivityManager::returnActivity</a>(<a class="code" href="class_activity.html">Activity</a> *activityObject)</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;{</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    <span class="comment">// START OF CRITICAL SECTION</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    {</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        <a class="code" href="class_resource_section.html">ResourceSection</a> lock;</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;        <span class="comment">// remove this from the activte list</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        <a class="code" href="class_activity_manager.html#a1695008449800eabf5aacab6e4ca3ec2">allActivities</a>-&gt;<a class="code" href="class_array_class.html#a9b1bdaa3efbb8fc70487082c6968ab9a">removeItem</a>(activityObject);</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        <span class="comment">// if we ended up pushing an old activity down when we attached this</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        <span class="comment">// thread, then we need to restore the old thread to active state.</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        <a class="code" href="class_activity.html">Activity</a> *oldActivity = activityObject-&gt;<a class="code" href="class_activity.html#a37ade6bc283d11d9664f15dacccc3e00">getNestedActivity</a>();</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160; </div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        <span class="comment">// there are two situations for a nested activity. The first is simple,</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        <span class="comment">// which is just a normal exit interpreter/reenter interpreter.</span></div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        <span class="comment">// The second is more complicated and can (as far as we know) only</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;        <span class="comment">// occur on Windows).</span></div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;        <span class="keywordflow">if</span> (oldActivity != <a class="code" href="_rexx_core_8h.html#a181a36438ba4535dd7d22ab63239d1e1">OREF_NULL</a>)</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        {</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;            <span class="comment">// this is the dispatch queue situation. We just return this</span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;            <span class="comment">// to the dispatch queue without waiting to obtain the kernel</span></div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;            <span class="comment">// lock.</span></div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;            <span class="keywordflow">if</span> (oldActivity-&gt;<a class="code" href="class_activity.html#ab406381b989e697aa4c695728dfc3795">isWaitingForDispatch</a>())</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;            {</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;                <a class="code" href="class_activity_manager.html#a0963e9c66056b234c20765b29e5f1fae">returnWaitingActivity</a>(oldActivity);</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;            }</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;            <span class="comment">// just remove the suspended state</span></div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;            {</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;                oldActivity-&gt;<a class="code" href="class_activity.html#a51801eafe5f3b7268029b021abe05f95">setSuspended</a>(<span class="keyword">false</span>);</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;            }</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;        }</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;        <span class="comment">// cleanup any system resources this activity might own</span></div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;        activityObject-&gt;<a class="code" href="class_activity.html#a3f0935db9cb7cff9c8ec267944bf213a">cleanupActivityResources</a>();</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    }</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;}</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160; </div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;<span class="comment"> * Return an activity to the activity pool.</span></div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;<span class="comment"> * @param activityObject</span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;<span class="comment"> *               The released activity.</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00833"></a><span class="lineno"><a class="line" href="class_activity_manager.html#aff9ff1ec4277c8f4689ca11db09a7b74">  833</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_activity_manager.html#aff9ff1ec4277c8f4689ca11db09a7b74">ActivityManager::activityEnded</a>(<a class="code" href="class_activity.html">Activity</a> *activityObject)</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;{</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    <span class="comment">// START OF CRITICAL SECTION</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    {</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;        <a class="code" href="class_resource_section.html">ResourceSection</a> lock;       <span class="comment">// this is a critical section</span></div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;        <span class="comment">// and also remove from the global list</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;        <a class="code" href="class_activity_manager.html#a1695008449800eabf5aacab6e4ca3ec2">allActivities</a>-&gt;<a class="code" href="class_array_class.html#a9b1bdaa3efbb8fc70487082c6968ab9a">removeItem</a>(activityObject);</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;        <span class="comment">// cleanup any system resources this activity might own</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;        activityObject-&gt;<a class="code" href="class_activity.html#a3f0935db9cb7cff9c8ec267944bf213a">cleanupActivityResources</a>();</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160; </div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        <span class="comment">// did we just release the last activity during a shutdown?  The shutdown</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;        <span class="comment">// can now complete.</span></div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="class_activity_manager.html#a0083bef91fb6b8a26f8738b7bfb9e24a">processTerminating</a> &amp;&amp; <a class="code" href="class_activity_manager.html#a1695008449800eabf5aacab6e4ca3ec2">allActivities</a>-&gt;<a class="code" href="class_array_class.html#af0c2bd6f0cc94c492c7119c43b8ea51e">isEmpty</a>())</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;        {</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;            <span class="comment">// notify any waiters that we&#39;re clear</span></div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;            <a class="code" href="class_activity_manager.html#a2ac5433e72cd154755540cd523871b10">postTermination</a>();</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;        }</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    }</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;}</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160; </div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<span class="comment"> * Get a root activity for a new interpreter instance.</span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;<span class="comment"> * @return The newly created activity.</span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00859"></a><span class="lineno"><a class="line" href="class_activity_manager.html#ad1342f694c4ade16b4ce6fc7deb1733b">  859</a></span>&#160;<a class="code" href="class_activity.html">Activity</a> *<a class="code" href="class_activity_manager.html#ad1342f694c4ade16b4ce6fc7deb1733b">ActivityManager::getRootActivity</a>()</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;{</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    <span class="comment">// it&#39;s possible we already have an activity active for this thread.  That</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    <span class="comment">// most likely occurs in nested RexxStart() calls.  Get that activity first,</span></div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    <span class="comment">// and if we have one, we&#39;ll need to push this down.</span></div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <a class="code" href="class_activity.html">Activity</a> *oldActivity = <a class="code" href="class_activity_manager.html#ae62aa7eb85ba887e9351fef8886b7678">findActivity</a>();</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160; </div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    <span class="comment">// we need to lock the kernel to have access to the memory manager to</span></div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    <span class="comment">// create this activity.</span></div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    <a class="code" href="class_activity_manager.html#a9379da3941a3e1eb36fd23bccd2c6de5">lockKernel</a>();</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160; </div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    <span class="comment">// get a new activity object</span></div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    <a class="code" href="class_activity.html">Activity</a> *activityObject = <a class="code" href="class_activity_manager.html#ad6803dcbd0b41129f3e5a95b101f9868">createCurrentActivity</a>();</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160; </div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <span class="comment">// mark this as the root activity for an interpreter instance.  Some operations</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    <span class="comment">// are only permitted from the root threads.</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    activityObject-&gt;<a class="code" href="class_activity.html#a481e369a487b5b0213a46c2baf5b84a9">setInterpreterRoot</a>();</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160; </div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    <span class="comment">// Do we have a nested interpreter call occurring on the same thread?  We need to</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    <span class="comment">// mark the old activity as suspended, and chain this to the new activity.</span></div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    <a class="code" href="class_activity_manager.html#af21c02d1b198da11b65681a71aed6b62">handleNestedActivity</a>(activityObject, oldActivity);</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160; </div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    <span class="comment">// this will help ensure that the code after the request access call</span></div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    <span class="comment">// is only executed after access acquired.</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    <a class="code" href="class_activity_manager.html#adb0c7cefcddab6472aafa4cf14d63276">sentinel</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160; </div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    activityObject-&gt;<a class="code" href="class_activity.html#a0aa06a9c66385cb88ad48b036b4d91b2">activate</a>();        <span class="comment">// let the activity know it&#39;s in use, potentially nested</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    activityObject-&gt;<a class="code" href="class_activity.html#aac136d1ebecd3672d123fe9aa9642c70">setupCurrentActivity</a>();     <span class="comment">// set this as the current activity</span></div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    <span class="keywordflow">return</span> activityObject;</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;}</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160; </div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;<span class="comment"> * return a root activity when an interpreter instance</span></div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;<span class="comment"> * terminates.</span></div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00895"></a><span class="lineno"><a class="line" href="class_activity_manager.html#a6364099f434f4c7e1110bfe7ecee1b01">  895</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_activity_manager.html#a6364099f434f4c7e1110bfe7ecee1b01">ActivityManager::returnRootActivity</a>(<a class="code" href="class_activity.html">Activity</a> *activity)</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;{</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    <span class="comment">// detach this from the instance.  This will also reactivate</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    <span class="comment">// and nested activity that&#39;s been pushed down.</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    activity-&gt;<a class="code" href="class_activity.html#a6af48d4b5d6dd47e2d8a4f033210db64">detachInstance</a>();</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;    <span class="comment">// make sure we release any system resources used by this activity, such as the semaphores</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    activity-&gt;<a class="code" href="class_activity.html#a3f0935db9cb7cff9c8ec267944bf213a">cleanupActivityResources</a>();</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160; </div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    <a class="code" href="class_resource_section.html">ResourceSection</a> lock;                <span class="comment">// need the control block locks</span></div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    <span class="comment">// remove this from the activity list so it will never get</span></div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    <span class="comment">// picked up again.</span></div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    <a class="code" href="class_activity_manager.html#a1695008449800eabf5aacab6e4ca3ec2">allActivities</a>-&gt;<a class="code" href="class_array_class.html#a9b1bdaa3efbb8fc70487082c6968ab9a">removeItem</a>(activity);</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;}</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160; </div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;<span class="comment"> * Handle nesting of activities caused by recursive reentry into the</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;<span class="comment"> * interpreter with a new attach or instance.</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;<span class="comment"> * @param newActivity</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;<span class="comment"> *               The newly created activity object.</span></div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;<span class="comment"> * @param oldActivity</span></div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;<span class="comment"> *               The (potential) old activity.</span></div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00919"></a><span class="lineno"><a class="line" href="class_activity_manager.html#af21c02d1b198da11b65681a71aed6b62">  919</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_activity_manager.html#af21c02d1b198da11b65681a71aed6b62">ActivityManager::handleNestedActivity</a>(<a class="code" href="class_activity.html">Activity</a> *newActivity, <a class="code" href="class_activity.html">Activity</a> *oldActivity)</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;{</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    <span class="comment">// Do we have a nested interpreter call occurring on the same thread?  We need to</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    <span class="comment">// mark the old activity as suspended, and chain this to the new activity.</span></div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    <span class="keywordflow">if</span> (oldActivity != <a class="code" href="_rexx_core_8h.html#a181a36438ba4535dd7d22ab63239d1e1">OREF_NULL</a>)</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    {</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;        <span class="comment">// if we have an activity on this thread that is waiting for dispatch,</span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;        <span class="comment">// then we need to make sure the old activity is removed from the</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;        <span class="comment">// dispatch queue and disabled until this new activity is detached.</span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;        <span class="keywordflow">if</span> (oldActivity-&gt;<a class="code" href="class_activity.html#ab406381b989e697aa4c695728dfc3795">isWaitingForDispatch</a>())</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;        {</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;            <span class="comment">// make sure this is never dispatched.</span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;            <a class="code" href="class_activity_manager.html#a7bb06e29ceb45d2e89c08b38f8ca25b4">suspendDispatch</a>(oldActivity);</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;        }</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;        <span class="comment">// this is a normal nested reentry, so just make it as suspended.</span></div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;        {</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;            oldActivity-&gt;<a class="code" href="class_activity.html#a51801eafe5f3b7268029b021abe05f95">setSuspended</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;        }</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;        <span class="comment">// this pushes this down the stack.</span></div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;        newActivity-&gt;<a class="code" href="class_activity.html#a31abb715056e403cd02d6129fc487b7b">setNestedActivity</a>(oldActivity);</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    }</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;}</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160; </div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;<span class="comment"> * Attach an activity to an interpreter instance</span></div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;<span class="comment"> * @param instance The interpreter instance involved.</span></div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;<span class="comment"> * @return A new activity instance created for this thread. This</span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;<span class="comment"> *         activity will own the kernel lock on return.</span></div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00952"></a><span class="lineno"><a class="line" href="class_activity_manager.html#a13ef45e383e6b2a0f85e1c2b2de4cfd2">  952</a></span>&#160;<a class="code" href="class_activity.html">Activity</a> *<a class="code" href="class_activity_manager.html#a13ef45e383e6b2a0f85e1c2b2de4cfd2">ActivityManager::attachThread</a>()</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;{</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    <span class="comment">// it&#39;s possible we already have an activity active for this thread.  That</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <span class="comment">// most likely occurs in nested RexxStart() calls.</span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    <a class="code" href="class_activity.html">Activity</a> *oldActivity = <a class="code" href="class_activity_manager.html#ae62aa7eb85ba887e9351fef8886b7678">findActivity</a>();</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    <span class="comment">// we have an activity created for this thread already.  The interpreter instance</span></div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    <span class="comment">// should already have handled the case of an attach for an already attached thread.</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    <span class="comment">// so we&#39;re going to have a new activity to create, and potentially an existing one to</span></div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    <span class="comment">// suspend. We may also need to remove the activity from the dispatch queue if</span></div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    <span class="comment">// it is there.</span></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160; </div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    <span class="comment">// we need to lock the kernel to have access to the memory manager to</span></div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    <span class="comment">// create this activity. This is an &quot;unowned&quot; lock, since there will not be</span></div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    <span class="comment">// an activity connected with it.</span></div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160; </div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    <span class="comment">// try the fast version first</span></div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="class_activity_manager.html#a559621dc7d57535d6c7bb0ccc9de7a01">lockKernelImmediate</a>())</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    {</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;        <a class="code" href="class_dispatch_section.html">DispatchSection</a> lock;                <span class="comment">// need the dispatch queue lock</span></div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160; </div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;        <a class="code" href="class_activity_manager.html#aa5e18d89bf550489c15da86f9f21e117">waitingAttaches</a>++;                   <span class="comment">// make sure we indicate that someone is waiting for this</span></div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;        <a class="code" href="class_activity_manager.html#adb0c7cefcddab6472aafa4cf14d63276">sentinel</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;        lock.<a class="code" href="class_dispatch_section.html#a95d468e85f726b8035498646338ee52d">release</a>();                      <span class="comment">// release the lock now</span></div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;        <a class="code" href="class_activity_manager.html#adb0c7cefcddab6472aafa4cf14d63276">sentinel</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160; </div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;        <a class="code" href="class_activity_manager.html#a9379da3941a3e1eb36fd23bccd2c6de5">lockKernel</a>();                        <span class="comment">// now wait for the semaphore to come free</span></div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160; </div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;        <a class="code" href="class_activity_manager.html#adb0c7cefcddab6472aafa4cf14d63276">sentinel</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;        lock.<a class="code" href="class_dispatch_section.html#a79d53d4065c167674c799081f525f498">reacquire</a>();                    <span class="comment">// get the resource lock back</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;        <a class="code" href="class_activity_manager.html#adb0c7cefcddab6472aafa4cf14d63276">sentinel</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;        <a class="code" href="class_activity_manager.html#aa5e18d89bf550489c15da86f9f21e117">waitingAttaches</a>--;                   <span class="comment">// remove our request to the lock</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    }</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160; </div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    <span class="comment">// now that we have the lock, we can allocate an activity object</span></div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <span class="comment">// from the heap.</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    <a class="code" href="class_activity.html">Activity</a> *activityObject = <a class="code" href="class_activity_manager.html#ad6803dcbd0b41129f3e5a95b101f9868">createCurrentActivity</a>();</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    <span class="comment">// Do we have a nested interpreter call occurring on the same thread?  We need to</span></div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    <span class="comment">// mark the old activity as suspended, and chain this to the new activity.</span></div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    <a class="code" href="class_activity_manager.html#af21c02d1b198da11b65681a71aed6b62">handleNestedActivity</a>(activityObject, oldActivity);</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160; </div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    <span class="comment">// this will help ensure that the following code is only executed after</span></div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    <span class="comment">// everything above is executed.</span></div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    <a class="code" href="class_activity_manager.html#adb0c7cefcddab6472aafa4cf14d63276">sentinel</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160; </div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;    <span class="comment">// We own the kernel lock, but there is no current activity set. While still</span></div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;    <span class="comment">// locked, make this the current activity and return. We don&#39;t want to release</span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    <span class="comment">// the lock yet because the garbage collector could get triggered on another</span></div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    <span class="comment">// thread.</span></div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    activityObject-&gt;<a class="code" href="class_activity.html#aac136d1ebecd3672d123fe9aa9642c70">setupCurrentActivity</a>();</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    <span class="keywordflow">return</span> activityObject;</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;}</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160; </div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;<span class="comment"> * Remove an activity from the dispatch queue when a</span></div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;<span class="comment"> * an attach is superceding an activity that is in the</span></div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;<span class="comment"> * dispatch queue.</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;<span class="comment"> * @param activity The activity to suspend.</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"><a class="line" href="class_activity_manager.html#a7bb06e29ceb45d2e89c08b38f8ca25b4"> 1012</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_activity_manager.html#a7bb06e29ceb45d2e89c08b38f8ca25b4">ActivityManager::suspendDispatch</a>(<a class="code" href="class_activity.html">Activity</a> *activity)</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;{</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;    <a class="code" href="class_dispatch_section.html">DispatchSection</a> lock;                <span class="comment">// need the dispatch queue lock</span></div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160; </div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    <span class="comment">// decrement the waiting counter until this is returned to the queue</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    <a class="code" href="class_activity_manager.html#a6dcf364f11149e8b8ae78c31e86ff460">waitingAccess</a>--;</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    <span class="comment">// if this was an API entry wait, remove it also</span></div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    <span class="keywordflow">if</span> (activity-&gt;<a class="code" href="class_activity.html#a3aeb1bab5ea6b4aeccc8de8446ce037c">isWaitingForApiAccess</a>())</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    {</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;        <a class="code" href="class_activity_manager.html#a3ae96cdf24c0cecc1074df9e60b4478c">waitingApiAccess</a>--;</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    }</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160; </div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="class_activity_manager.html#a374af8561e8974a80fb0f976eeeda701">waitingActivities</a>.empty())</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    {</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160; </div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;        <span class="comment">// if this activity is at the front of the queue, then we need to remove</span></div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;        <span class="comment">// this and dispatch the new front element.</span></div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="class_activity_manager.html#a374af8561e8974a80fb0f976eeeda701">waitingActivities</a>.front() == activity)</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;        {</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;            <span class="comment">// We can generally only get here if the activity is waiting on either the</span></div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;            <span class="comment">// run semaphore or the kernel semaphore already. This will not wake up again</span></div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;            <span class="comment">// until the current activity stack unwinds to the semaphore call, so</span></div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;            <span class="comment">// we remove this from the queue so it doesn&#39;t keep getting dispatched and</span></div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;            <span class="comment">// them poke the next activity in line if there is one. This will get</span></div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;            <span class="comment">// returned to the queue once the re-entry is complete.</span></div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;            <a class="code" href="class_activity_manager.html#a374af8561e8974a80fb0f976eeeda701">waitingActivities</a>.pop_front();</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;            <span class="comment">// If we have another activity in the queue, dispatch it now.</span></div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;            <a class="code" href="class_activity_manager.html#ae690a4e2ac463f50d4377a1f385aec64">dispatchNext</a>();</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;        }</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;        <span class="comment">// we&#39;re in line behind some other activity, so just remove this one</span></div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;        <span class="comment">// from the queue. We don&#39;t need to repost anything at this point.</span></div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;        {</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;            <a class="code" href="class_activity_manager.html#ad31635138f600d263697c9791ee54fa5">removeWaitingActivity</a>(activity);</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;        }</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    }</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;}</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160; </div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;<span class="comment"> * In certain situations (mostly confined to Windows),</span></div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="comment"> * we can re-enter the interpreter on a thread that is</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="comment"> * currently on the dispatch queue. If that activity gets</span></div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="comment"> * dispatched, then everything blocks because the</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;<span class="comment"> * activity never wakes up until the nested thread returns.</span></div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;<span class="comment"> * In that situation, we need to ensure that the original</span></div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;<span class="comment"> * waiting activity is removed from the dispatch queue</span></div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="comment"> * until it is the top activity on the stack.</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="comment"> * @param waitingAct The activity to remove from the queue.</span></div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"><a class="line" href="class_activity_manager.html#ad31635138f600d263697c9791ee54fa5"> 1063</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_activity_manager.html#ad31635138f600d263697c9791ee54fa5">ActivityManager::removeWaitingActivity</a>(<a class="code" href="class_activity.html">Activity</a> *waitingAct)</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;{</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    <span class="comment">// NOTE: The caller must be holding the dispatch lock</span></div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160; </div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    <span class="comment">// iterators don&#39;t work if the collection is empty, so</span></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    <span class="comment">// this can occur if the run semaphore has already been posted.</span></div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="class_activity_manager.html#a374af8561e8974a80fb0f976eeeda701">waitingActivities</a>.empty())</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    {</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    }</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160; </div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    <span class="comment">// search for the activity position and remove it.</span></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    <span class="keywordflow">for</span> (std::deque&lt;Activity *&gt;::iterator it = <a class="code" href="class_activity_manager.html#a374af8561e8974a80fb0f976eeeda701">waitingActivities</a>.begin(); it != <a class="code" href="class_activity_manager.html#a374af8561e8974a80fb0f976eeeda701">waitingActivities</a>.end(); ++it)</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    {</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;        <span class="comment">// if this is found, remove it from the queue</span></div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;        <span class="keywordflow">if</span> (*it == waitingAct)</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;        {</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;            <a class="code" href="class_activity_manager.html#a374af8561e8974a80fb0f976eeeda701">waitingActivities</a>.erase(it);</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;        }</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    }</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    <span class="comment">// ignore this if not found.</span></div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;}</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160; </div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;<span class="comment"> * Get an already existing activity for the current thread and</span></div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;<span class="comment"> * give it kernel access before returning.  This will fail if</span></div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;<span class="comment"> * the thread has not been properly attached.</span></div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="comment"> * @return The activity for this thread.</span></div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01095"></a><span class="lineno"><a class="line" href="class_activity_manager.html#af5ced23fc1e0e34c41447375535452bf"> 1095</a></span>&#160;<a class="code" href="class_activity.html">Activity</a> *<a class="code" href="class_activity_manager.html#af5ced23fc1e0e34c41447375535452bf">ActivityManager::getActivity</a>()</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;{</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    <span class="comment">// it&#39;s possible we already have an activity active for this thread.  That</span></div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    <span class="comment">// most likely occurs in nested RexxStart() calls.</span></div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    <a class="code" href="class_activity.html">Activity</a> *activityObject = <a class="code" href="class_activity_manager.html#ae62aa7eb85ba887e9351fef8886b7678">findActivity</a>();</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    <span class="comment">// we generally should have something.  Somehow we have an improperly</span></div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    <span class="comment">// attached thread.  Just return a failure indicator.</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    <span class="keywordflow">if</span> (activityObject == <a class="code" href="_rexx_core_8h.html#a181a36438ba4535dd7d22ab63239d1e1">OREF_NULL</a>)</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    {</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="_rexx_core_8h.html#a181a36438ba4535dd7d22ab63239d1e1">OREF_NULL</a>;</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    }</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    <span class="comment">// go acquire the kernel lock and take care of nesting</span></div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    activityObject-&gt;<a class="code" href="class_activity.html#aad54e4f1d12aea20586a66a6f184fd16">enterCurrentThread</a>();</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    <span class="keywordflow">return</span> activityObject;             <span class="comment">// Return the activity for thread</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;}</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160; </div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;<span class="comment"> * Retrieve a variable from the current local environment</span></div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;<span class="comment"> * object.</span></div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;<span class="comment"> * @param name   The name of the environment variable.</span></div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;<span class="comment"> * @return The object stored in .local at the requested name.</span></div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01120"></a><span class="lineno"><a class="line" href="class_activity_manager.html#ab23aaa3f72c33cc165f02d35b3e9ef5f"> 1120</a></span>&#160;<a class="code" href="class_rexx_object.html">RexxObject</a> *<a class="code" href="class_activity_manager.html#ab23aaa3f72c33cc165f02d35b3e9ef5f">ActivityManager::getLocalEnvironment</a>(<a class="code" href="class_rexx_string.html">RexxString</a> *name)</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;{</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="class_activity_manager.html#a79b68d826eb48037838a9eab89e730fe">currentActivity</a> == <a class="code" href="_rexx_core_8h.html#a181a36438ba4535dd7d22ab63239d1e1">OREF_NULL</a>)</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    {</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="_rexx_core_8h.html#aa5515f75fb39f2b4faa40164a3ee51d1">TheNilObject</a>;</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    }</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_activity_manager.html#a79b68d826eb48037838a9eab89e730fe">currentActivity</a>-&gt;<a class="code" href="class_activity.html#a6c7e01ea5e7426164e212066a42f55d9">getLocalEnvironment</a>(name);</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;}</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160; </div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;<span class="comment"> * Retrieve the current .local directory instance.</span></div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;<span class="comment"> * @return The .local directory for the current activity.</span></div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01135"></a><span class="lineno"><a class="line" href="class_activity_manager.html#aef4fd0c82b79fd109906b4c545c3179a"> 1135</a></span>&#160;<a class="code" href="class_directory_class.html">DirectoryClass</a> *<a class="code" href="class_activity_manager.html#aef4fd0c82b79fd109906b4c545c3179a">ActivityManager::getLocal</a>()</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;{</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="class_activity_manager.html#a79b68d826eb48037838a9eab89e730fe">currentActivity</a> == <a class="code" href="_rexx_core_8h.html#a181a36438ba4535dd7d22ab63239d1e1">OREF_NULL</a>)</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    {</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="_rexx_core_8h.html#a181a36438ba4535dd7d22ab63239d1e1">OREF_NULL</a>;</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    }</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_activity_manager.html#a79b68d826eb48037838a9eab89e730fe">currentActivity</a>-&gt;<a class="code" href="class_activity.html#ab9549842dc203a442fdce4be90031fb7">getLocal</a>();</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;}</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160; </div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;<span class="comment"> * Enter a native context block.  This will locate the appropriate</span></div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;<span class="comment"> * activity for this callback and acquire kernel access on that</span></div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;<span class="comment"> * activity.  If this thread has never been used, then a new</span></div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;<span class="comment"> * interpreter instance will be created and the thread attached</span></div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;<span class="comment"> * to that instance.</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01152"></a><span class="lineno"><a class="line" href="class_native_context_block.html#a4d568edf129d6cb25e88b723a3da6263"> 1152</a></span>&#160;<a class="code" href="class_native_context_block.html#a4d568edf129d6cb25e88b723a3da6263">NativeContextBlock::NativeContextBlock</a>()</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;{</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    <span class="comment">// default to no instance</span></div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    <a class="code" href="class_native_context_block.html#a55902c9218de1f2f15f7baae0966163a">instance</a> = <a class="code" href="_rexx_core_8h.html#a181a36438ba4535dd7d22ab63239d1e1">OREF_NULL</a>;</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;    <a class="code" href="class_native_context_block.html#a730574b7725f37909153d56411767d61">activity</a> = <a class="code" href="class_activity_manager.html#af5ced23fc1e0e34c41447375535452bf">ActivityManager::getActivity</a>();</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    <span class="comment">// if not reentering on an existing thread, we create a new instance</span></div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    <span class="comment">// temporarily to service this request.  Many functions will</span></div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;    <span class="comment">// not make sense called this way.</span></div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="class_native_context_block.html#a730574b7725f37909153d56411767d61">activity</a> == <a class="code" href="_rexx_core_8h.html#a181a36438ba4535dd7d22ab63239d1e1">OREF_NULL</a>)</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    {</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;        <span class="comment">// Get an instance.  This also gives the root activity of the instance</span></div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;        <span class="comment">// the kernel lock.</span></div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;        <a class="code" href="class_native_context_block.html#a55902c9218de1f2f15f7baae0966163a">instance</a> = <a class="code" href="class_interpreter.html#ae112be57922520b47dfe2af683f17770">Interpreter::createInterpreterInstance</a>();</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;        <a class="code" href="class_native_context_block.html#a730574b7725f37909153d56411767d61">activity</a> = <a class="code" href="class_native_context_block.html#a55902c9218de1f2f15f7baae0966163a">instance</a>-&gt;<a class="code" href="class_interpreter_instance.html#a37d28d4ed8dc4a8442c0b7cb17f250f0">getRootActivity</a>();</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160; </div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    }</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    <span class="keyword">self</span> = (<a class="code" href="class_native_activation.html">NativeActivation</a> *)<a class="code" href="class_native_context_block.html#a730574b7725f37909153d56411767d61">activity</a>-&gt;<a class="code" href="class_activity.html#af6d4269e8b290ed379fc063a0abe876b">getTopStackFrame</a>();</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;}</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160; </div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;<span class="comment"> * Release the kernal access and cleanup when the context block</span></div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;<span class="comment"> * goes out of scope.</span></div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01176"></a><span class="lineno"><a class="line" href="class_native_context_block.html#aace83c4aa8537bd49bac339949332863"> 1176</a></span>&#160;<a class="code" href="class_native_context_block.html#aace83c4aa8537bd49bac339949332863">NativeContextBlock::~NativeContextBlock</a>()</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;{</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    <a class="code" href="class_native_context_block.html#a730574b7725f37909153d56411767d61">activity</a>-&gt;<a class="code" href="class_activity.html#a5fea135a4ff8a569de562ece8c96860e">exitCurrentThread</a>();</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="class_native_context_block.html#a55902c9218de1f2f15f7baae0966163a">instance</a> != <a class="code" href="_rexx_core_8h.html#a181a36438ba4535dd7d22ab63239d1e1">OREF_NULL</a>)</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    {</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;        <span class="comment">// terminate the instance</span></div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;        <a class="code" href="class_native_context_block.html#a55902c9218de1f2f15f7baae0966163a">instance</a>-&gt;<a class="code" href="class_interpreter_instance.html#a3c3bad1a0127677d28af8150743df064">terminate</a>();</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;    }</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;}</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160; </div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;<span class="comment"> * Protect an object that associated with the current native</span></div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;<span class="comment"> * context.  This creates a local reference that will lock</span></div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;<span class="comment"> * the object into memory until the native activation is</span></div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;<span class="comment"> * popped off the stack.</span></div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;<span class="comment"> * @param o      The object to protect (can be null).</span></div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;<span class="comment"> * @return The protected object.</span></div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01197"></a><span class="lineno"><a class="line" href="class_native_context_block.html#abc5f749266ad7811b454782236e67cf0"> 1197</a></span>&#160;<a class="code" href="class_rexx_object.html">RexxObject</a> *<a class="code" href="class_native_context_block.html#abc5f749266ad7811b454782236e67cf0">NativeContextBlock::protect</a>(<a class="code" href="class_rexx_object.html">RexxObject</a> *o)</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;{</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    <span class="keyword">self</span>-&gt;createLocalReference(o);</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    <span class="keywordflow">return</span> o;</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;}</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160; </div>
<div class="ttc" id="a_activation_settings_8hpp_html_a927998540344942bf3382d87499acce7"><div class="ttname"><a href="_activation_settings_8hpp.html#a927998540344942bf3382d87499acce7">ActivationContext</a></div><div class="ttdeci">ActivationContext</div><div class="ttdef"><b>Definition:</b> <a href="_activation_settings_8hpp_source.html#l00065">ActivationSettings.hpp:66</a></div></div>
<div class="ttc" id="a_activity_8hpp_html"><div class="ttname"><a href="_activity_8hpp.html">Activity.hpp</a></div></div>
<div class="ttc" id="a_activity_manager_8hpp_html"><div class="ttname"><a href="_activity_manager_8hpp.html">ActivityManager.hpp</a></div></div>
<div class="ttc" id="a_directory_class_8hpp_html"><div class="ttname"><a href="_directory_class_8hpp.html">DirectoryClass.hpp</a></div></div>
<div class="ttc" id="a_global_protected_object_8hpp_html"><div class="ttname"><a href="_global_protected_object_8hpp.html">GlobalProtectedObject.hpp</a></div></div>
<div class="ttc" id="a_interpreter_8hpp_html"><div class="ttname"><a href="_interpreter_8hpp.html">Interpreter.hpp</a></div></div>
<div class="ttc" id="a_interpreter_instance_8hpp_html"><div class="ttname"><a href="_interpreter_instance_8hpp.html">InterpreterInstance.hpp</a></div></div>
<div class="ttc" id="a_native_activation_8hpp_html"><div class="ttname"><a href="_native_activation_8hpp.html">NativeActivation.hpp</a></div></div>
<div class="ttc" id="a_object_class_8hpp_html_a09453535aa429cceaa131b911d4caa73"><div class="ttname"><a href="_object_class_8hpp.html#a09453535aa429cceaa131b911d4caa73">MarkReason</a></div><div class="ttdeci">MarkReason</div><div class="ttdef"><b>Definition:</b> <a href="_object_class_8hpp_source.html#l00080">ObjectClass.hpp:81</a></div></div>
<div class="ttc" id="a_object_class_8hpp_html_a09453535aa429cceaa131b911d4caa73a3fc1a0e7009347055cf152f1c3cc72b9"><div class="ttname"><a href="_object_class_8hpp.html#a09453535aa429cceaa131b911d4caa73a3fc1a0e7009347055cf152f1c3cc72b9">SAVINGIMAGE</a></div><div class="ttdeci">@ SAVINGIMAGE</div><div class="ttdef"><b>Definition:</b> <a href="_object_class_8hpp_source.html#l00086">ObjectClass.hpp:86</a></div></div>
<div class="ttc" id="a_protected_object_8hpp_html"><div class="ttname"><a href="_protected_object_8hpp.html">ProtectedObject.hpp</a></div></div>
<div class="ttc" id="a_queue_class_8hpp_html"><div class="ttname"><a href="_queue_class_8hpp.html">QueueClass.hpp</a></div></div>
<div class="ttc" id="a_queue_class_8hpp_html_aa8a6cd98d6466c32c590ec18c39874e6"><div class="ttname"><a href="_queue_class_8hpp.html#aa8a6cd98d6466c32c590ec18c39874e6">new_queue</a></div><div class="ttdeci">QueueClass * new_queue()</div><div class="ttdef"><b>Definition:</b> <a href="_queue_class_8hpp_source.html#l00084">QueueClass.hpp:84</a></div></div>
<div class="ttc" id="a_rexx_activation_8hpp_html"><div class="ttname"><a href="_rexx_activation_8hpp.html">RexxActivation.hpp</a></div></div>
<div class="ttc" id="a_rexx_core_8h_html"><div class="ttname"><a href="_rexx_core_8h.html">RexxCore.h</a></div></div>
<div class="ttc" id="a_rexx_core_8h_html_a181a36438ba4535dd7d22ab63239d1e1"><div class="ttname"><a href="_rexx_core_8h.html#a181a36438ba4535dd7d22ab63239d1e1">OREF_NULL</a></div><div class="ttdeci">#define OREF_NULL</div><div class="ttdef"><b>Definition:</b> <a href="_rexx_core_8h_source.html#l00055">RexxCore.h:55</a></div></div>
<div class="ttc" id="a_rexx_core_8h_html_aa5515f75fb39f2b4faa40164a3ee51d1"><div class="ttname"><a href="_rexx_core_8h.html#aa5515f75fb39f2b4faa40164a3ee51d1">TheNilObject</a></div><div class="ttdeci">#define TheNilObject</div><div class="ttdef"><b>Definition:</b> <a href="_rexx_core_8h_source.html#l00272">RexxCore.h:272</a></div></div>
<div class="ttc" id="a_rexx_memory_8hpp_html_a10ca07add5704523d065b7f2d2637f7d"><div class="ttname"><a href="_rexx_memory_8hpp.html#a10ca07add5704523d065b7f2d2637f7d">memory_mark</a></div><div class="ttdeci">#define memory_mark(oref)</div><div class="ttdef"><b>Definition:</b> <a href="_rexx_memory_8hpp_source.html#l00489">RexxMemory.hpp:489</a></div></div>
<div class="ttc" id="a_rexx_memory_8hpp_html_ad740c29e8223b639f6f3fcbb910ce21a"><div class="ttname"><a href="_rexx_memory_8hpp.html#ad740c29e8223b639f6f3fcbb910ce21a">memory_mark_general</a></div><div class="ttdeci">#define memory_mark_general(oref)</div><div class="ttdef"><b>Definition:</b> <a href="_rexx_memory_8hpp_source.html#l00490">RexxMemory.hpp:490</a></div></div>
<div class="ttc" id="aclass_activity_html"><div class="ttname"><a href="class_activity.html">Activity</a></div><div class="ttdef"><b>Definition:</b> <a href="_activity_8hpp_source.html#l00090">Activity.hpp:91</a></div></div>
<div class="ttc" id="aclass_activity_html_a09036ea1d71dbf5e8211477048d451fd"><div class="ttname"><a href="class_activity.html#a09036ea1d71dbf5e8211477048d451fd">Activity::clearRunWait</a></div><div class="ttdeci">void clearRunWait()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_8hpp_source.html#l00298">Activity.hpp:298</a></div></div>
<div class="ttc" id="aclass_activity_html_a0aa06a9c66385cb88ad48b036b4d91b2"><div class="ttname"><a href="class_activity.html#a0aa06a9c66385cb88ad48b036b4d91b2">Activity::activate</a></div><div class="ttdeci">void activate()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_8hpp_source.html#l00235">Activity.hpp:235</a></div></div>
<div class="ttc" id="aclass_activity_html_a0f0c091a0c40049e10a9862f24287cf7"><div class="ttname"><a href="class_activity.html#a0f0c091a0c40049e10a9862f24287cf7">Activity::clearWaitingForDispatch</a></div><div class="ttdeci">void clearWaitingForDispatch()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_8hpp_source.html#l00242">Activity.hpp:242</a></div></div>
<div class="ttc" id="aclass_activity_html_a31abb715056e403cd02d6129fc487b7b"><div class="ttname"><a href="class_activity.html#a31abb715056e403cd02d6129fc487b7b">Activity::setNestedActivity</a></div><div class="ttdeci">void setNestedActivity(Activity *a)</div><div class="ttdef"><b>Definition:</b> <a href="_activity_8hpp_source.html#l00253">Activity.hpp:253</a></div></div>
<div class="ttc" id="aclass_activity_html_a37ade6bc283d11d9664f15dacccc3e00"><div class="ttname"><a href="class_activity.html#a37ade6bc283d11d9664f15dacccc3e00">Activity::getNestedActivity</a></div><div class="ttdeci">Activity * getNestedActivity()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_8hpp_source.html#l00254">Activity.hpp:254</a></div></div>
<div class="ttc" id="aclass_activity_html_a3aeb1bab5ea6b4aeccc8de8446ce037c"><div class="ttname"><a href="class_activity.html#a3aeb1bab5ea6b4aeccc8de8446ce037c">Activity::isWaitingForApiAccess</a></div><div class="ttdeci">bool isWaitingForApiAccess()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_8hpp_source.html#l00247">Activity.hpp:247</a></div></div>
<div class="ttc" id="aclass_activity_html_a3f0935db9cb7cff9c8ec267944bf213a"><div class="ttname"><a href="class_activity.html#a3f0935db9cb7cff9c8ec267944bf213a">Activity::cleanupActivityResources</a></div><div class="ttdeci">void cleanupActivityResources()</div><div class="ttdef"><b>Definition:</b> <a href="_activity-trace_8cpp_source.html#l00280">Activity-trace.cpp:280</a></div></div>
<div class="ttc" id="aclass_activity_html_a481e369a487b5b0213a46c2baf5b84a9"><div class="ttname"><a href="class_activity.html#a481e369a487b5b0213a46c2baf5b84a9">Activity::setInterpreterRoot</a></div><div class="ttdeci">void setInterpreterRoot()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_8hpp_source.html#l00252">Activity.hpp:252</a></div></div>
<div class="ttc" id="aclass_activity_html_a51801eafe5f3b7268029b021abe05f95"><div class="ttname"><a href="class_activity.html#a51801eafe5f3b7268029b021abe05f95">Activity::setSuspended</a></div><div class="ttdeci">void setSuspended(bool s)</div><div class="ttdef"><b>Definition:</b> <a href="_activity_8hpp_source.html#l00250">Activity.hpp:250</a></div></div>
<div class="ttc" id="aclass_activity_html_a54ae3894cea6c23b1a497ac1d7c19c3b"><div class="ttname"><a href="class_activity.html#a54ae3894cea6c23b1a497ac1d7c19c3b">Activity::yield</a></div><div class="ttdeci">void yield()</div><div class="ttdef"><b>Definition:</b> <a href="_activity-trace_8cpp_source.html#l02115">Activity-trace.cpp:2115</a></div></div>
<div class="ttc" id="aclass_activity_html_a59c0b74c4d3989daa393d211792d4383"><div class="ttname"><a href="class_activity.html#a59c0b74c4d3989daa393d211792d4383">Activity::isSuspended</a></div><div class="ttdeci">bool isSuspended()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_8hpp_source.html#l00241">Activity.hpp:241</a></div></div>
<div class="ttc" id="aclass_activity_html_a5fea135a4ff8a569de562ece8c96860e"><div class="ttname"><a href="class_activity.html#a5fea135a4ff8a569de562ece8c96860e">Activity::exitCurrentThread</a></div><div class="ttdeci">void exitCurrentThread()</div><div class="ttdef"><b>Definition:</b> <a href="_activity-trace_8cpp_source.html#l00312">Activity-trace.cpp:312</a></div></div>
<div class="ttc" id="aclass_activity_html_a6af48d4b5d6dd47e2d8a4f033210db64"><div class="ttname"><a href="class_activity.html#a6af48d4b5d6dd47e2d8a4f033210db64">Activity::detachInstance</a></div><div class="ttdeci">void detachInstance()</div><div class="ttdef"><b>Definition:</b> <a href="_activity-trace_8cpp_source.html#l01859">Activity-trace.cpp:1859</a></div></div>
<div class="ttc" id="aclass_activity_html_a6c7e01ea5e7426164e212066a42f55d9"><div class="ttname"><a href="class_activity.html#a6c7e01ea5e7426164e212066a42f55d9">Activity::getLocalEnvironment</a></div><div class="ttdeci">RexxObject * getLocalEnvironment(RexxString *name)</div><div class="ttdef"><b>Definition:</b> <a href="_activity-trace_8cpp_source.html#l03554">Activity-trace.cpp:3554</a></div></div>
<div class="ttc" id="aclass_activity_html_a766b5fae138d858cace65817bbe02e4f"><div class="ttname"><a href="class_activity.html#a766b5fae138d858cace65817bbe02e4f">Activity::setWaitingForDispatch</a></div><div class="ttdeci">void setWaitingForDispatch()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_8hpp_source.html#l00243">Activity.hpp:243</a></div></div>
<div class="ttc" id="aclass_activity_html_a934a011d93bb8fefdff7300b14da8f21"><div class="ttname"><a href="class_activity.html#a934a011d93bb8fefdff7300b14da8f21">Activity::isThread</a></div><div class="ttdeci">bool isThread(thread_id_t id)</div><div class="ttdef"><b>Definition:</b> <a href="_activity_8hpp_source.html#l00194">Activity.hpp:194</a></div></div>
<div class="ttc" id="aclass_activity_html_aac136d1ebecd3672d123fe9aa9642c70"><div class="ttname"><a href="class_activity.html#aac136d1ebecd3672d123fe9aa9642c70">Activity::setupCurrentActivity</a></div><div class="ttdeci">void setupCurrentActivity()</div><div class="ttdef"><b>Definition:</b> <a href="_activity-trace_8cpp_source.html#l02251">Activity-trace.cpp:2251</a></div></div>
<div class="ttc" id="aclass_activity_html_aad54e4f1d12aea20586a66a6f184fd16"><div class="ttname"><a href="class_activity.html#aad54e4f1d12aea20586a66a6f184fd16">Activity::enterCurrentThread</a></div><div class="ttdeci">void enterCurrentThread()</div><div class="ttdef"><b>Definition:</b> <a href="_activity-trace_8cpp_source.html#l00330">Activity-trace.cpp:330</a></div></div>
<div class="ttc" id="aclass_activity_html_ab2ea2b8ea22e4817f5561c8265dad491"><div class="ttname"><a href="class_activity.html#ab2ea2b8ea22e4817f5561c8265dad491">Activity::terminatePoolActivity</a></div><div class="ttdeci">void terminatePoolActivity()</div><div class="ttdef"><b>Definition:</b> <a href="_activity-trace_8cpp_source.html#l03340">Activity-trace.cpp:3340</a></div></div>
<div class="ttc" id="aclass_activity_html_ab406381b989e697aa4c695728dfc3795"><div class="ttname"><a href="class_activity.html#ab406381b989e697aa4c695728dfc3795">Activity::isWaitingForDispatch</a></div><div class="ttdeci">bool isWaitingForDispatch()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_8hpp_source.html#l00244">Activity.hpp:244</a></div></div>
<div class="ttc" id="aclass_activity_html_ab9549842dc203a442fdce4be90031fb7"><div class="ttname"><a href="class_activity.html#ab9549842dc203a442fdce4be90031fb7">Activity::getLocal</a></div><div class="ttdeci">DirectoryClass * getLocal()</div><div class="ttdef"><b>Definition:</b> <a href="_activity-trace_8cpp_source.html#l02279">Activity-trace.cpp:2279</a></div></div>
<div class="ttc" id="aclass_activity_html_ac2a5f9935f15452d9d8bf131e59bc7bd"><div class="ttname"><a href="class_activity.html#ac2a5f9935f15452d9d8bf131e59bc7bd">Activity::reset</a></div><div class="ttdeci">void reset()</div><div class="ttdef"><b>Definition:</b> <a href="_activity-trace_8cpp_source.html#l00411">Activity-trace.cpp:411</a></div></div>
<div class="ttc" id="aclass_activity_html_ac58f8dacee596f50ddaa42b695e51768"><div class="ttname"><a href="class_activity.html#ac58f8dacee596f50ddaa42b695e51768">Activity::waitForKernel</a></div><div class="ttdeci">void waitForKernel()</div><div class="ttdef"><b>Definition:</b> <a href="_activity-trace_8cpp_source.html#l02236">Activity-trace.cpp:2236</a></div></div>
<div class="ttc" id="aclass_activity_html_acbd9182699d31f0497e0533e5f7f4e9a"><div class="ttname"><a href="class_activity.html#acbd9182699d31f0497e0533e5f7f4e9a">Activity::hasRunPermission</a></div><div class="ttdeci">bool hasRunPermission()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_8hpp_source.html#l00287">Activity.hpp:287</a></div></div>
<div class="ttc" id="aclass_activity_html_ad3d2e4220ba7c5e34ab88a306d6f0e92"><div class="ttname"><a href="class_activity.html#ad3d2e4220ba7c5e34ab88a306d6f0e92">Activity::setTrace</a></div><div class="ttdeci">bool setTrace(bool)</div><div class="ttdef"><b>Definition:</b> <a href="_activity-trace_8cpp_source.html#l02159">Activity-trace.cpp:2159</a></div></div>
<div class="ttc" id="aclass_activity_html_addab59a20b8cc38fc8d9a6715e276d92"><div class="ttname"><a href="class_activity.html#addab59a20b8cc38fc8d9a6715e276d92">Activity::waitForDispatch</a></div><div class="ttdeci">bool waitForDispatch()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_8hpp_source.html#l00269">Activity.hpp:269</a></div></div>
<div class="ttc" id="aclass_activity_html_aebcd5f73a74aff6334327eddbef1f802"><div class="ttname"><a href="class_activity.html#aebcd5f73a74aff6334327eddbef1f802">Activity::halt</a></div><div class="ttdeci">bool halt(RexxString *)</div><div class="ttdef"><b>Definition:</b> <a href="_activity-trace_8cpp_source.html#l02136">Activity-trace.cpp:2136</a></div></div>
<div class="ttc" id="aclass_activity_html_af6d4269e8b290ed379fc063a0abe876b"><div class="ttname"><a href="class_activity.html#af6d4269e8b290ed379fc063a0abe876b">Activity::getTopStackFrame</a></div><div class="ttdeci">ActivationBase * getTopStackFrame()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_8hpp_source.html#l00292">Activity.hpp:292</a></div></div>
<div class="ttc" id="aclass_activity_html_afcaa9e814b1d80f36d3fdb7f3622d598"><div class="ttname"><a href="class_activity.html#afcaa9e814b1d80f36d3fdb7f3622d598">Activity::postDispatch</a></div><div class="ttdeci">void postDispatch()</div><div class="ttdef"><b>Definition:</b> <a href="_activity-trace_8cpp_source.html#l02082">Activity-trace.cpp:2082</a></div></div>
<div class="ttc" id="aclass_activity_html_afd9236a307a080a4d97139c344117fac"><div class="ttname"><a href="class_activity.html#afd9236a307a080a4d97139c344117fac">Activity::inheritSettings</a></div><div class="ttdeci">void inheritSettings(Activity *parent)</div><div class="ttdef"><b>Definition:</b> <a href="_activity-trace_8cpp_source.html#l03461">Activity-trace.cpp:3461</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_a0083bef91fb6b8a26f8738b7bfb9e24a"><div class="ttname"><a href="class_activity_manager.html#a0083bef91fb6b8a26f8738b7bfb9e24a">ActivityManager::processTerminating</a></div><div class="ttdeci">static bool processTerminating</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8hpp_source.html#l00189">ActivityManager.hpp:189</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_a01366e1f82be7ff807af6e69d1f09080"><div class="ttname"><a href="class_activity_manager.html#a01366e1f82be7ff807af6e69d1f09080">ActivityManager::terminationSem</a></div><div class="ttdeci">static SysSemaphore terminationSem</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8hpp_source.html#l00196">ActivityManager.hpp:196</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_a021516beb284d95badb7953264601514"><div class="ttname"><a href="class_activity_manager.html#a021516beb284d95badb7953264601514">ActivityManager::yieldCurrentActivity</a></div><div class="ttdeci">static void yieldCurrentActivity()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l00667">ActivityManager.cpp:667</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_a035de91a5aff30fa3301451b20861143"><div class="ttname"><a href="class_activity_manager.html#a035de91a5aff30fa3301451b20861143">ActivityManager::MAX_THREAD_POOL_SIZE</a></div><div class="ttdeci">static const size_t MAX_THREAD_POOL_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8hpp_source.html#l00184">ActivityManager.hpp:184</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_a064f7e40095ac35e43214e76dd2c871f"><div class="ttname"><a href="class_activity_manager.html#a064f7e40095ac35e43214e76dd2c871f">ActivityManager::releaseAccess</a></div><div class="ttdeci">static void releaseAccess()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l00730">ActivityManager.cpp:730</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_a0963e9c66056b234c20765b29e5f1fae"><div class="ttname"><a href="class_activity_manager.html#a0963e9c66056b234c20765b29e5f1fae">ActivityManager::returnWaitingActivity</a></div><div class="ttdeci">static void returnWaitingActivity(Activity *waitingAct)</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l00342">ActivityManager.cpp:342</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_a0b6a875441a4e8f864c70fb39a41272f"><div class="ttname"><a href="class_activity_manager.html#a0b6a875441a4e8f864c70fb39a41272f">ActivityManager::setActivityTrace</a></div><div class="ttdeci">static bool setActivityTrace(thread_id_t thread_id, bool on_or_off)</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l00650">ActivityManager.cpp:650</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_a0cfa9ecefdc20abfe92237d7cdf6c62c"><div class="ttname"><a href="class_activity_manager.html#a0cfa9ecefdc20abfe92237d7cdf6c62c">ActivityManager::availableActivities</a></div><div class="ttdeci">static QueueClass * availableActivities</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8hpp_source.html#l00187">ActivityManager.hpp:187</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_a1290ffb98f94914ac24bfd7dc858b5c1"><div class="ttname"><a href="class_activity_manager.html#a1290ffb98f94914ac24bfd7dc858b5c1">ActivityManager::poolActivity</a></div><div class="ttdeci">static bool poolActivity(Activity *activity)</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l00594">ActivityManager.cpp:594</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_a13ef45e383e6b2a0f85e1c2b2de4cfd2"><div class="ttname"><a href="class_activity_manager.html#a13ef45e383e6b2a0f85e1c2b2de4cfd2">ActivityManager::attachThread</a></div><div class="ttdeci">static Activity * attachThread()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l00952">ActivityManager.cpp:952</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_a1695008449800eabf5aacab6e4ca3ec2"><div class="ttname"><a href="class_activity_manager.html#a1695008449800eabf5aacab6e4ca3ec2">ActivityManager::allActivities</a></div><div class="ttdeci">static QueueClass * allActivities</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8hpp_source.html#l00188">ActivityManager.hpp:188</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_a1e666f0a1ab4359d08c6b72c531b6345"><div class="ttname"><a href="class_activity_manager.html#a1e666f0a1ab4359d08c6b72c531b6345">ActivityManager::newNativeActivation</a></div><div class="ttdeci">static NativeActivation * newNativeActivation(Activity *activity, RexxActivation *parent)</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l00468">ActivityManager.cpp:468</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_a1f895528d5ed0f44c92d597c72f6f55a"><div class="ttname"><a href="class_activity_manager.html#a1f895528d5ed0f44c92d597c72f6f55a">ActivityManager::clearActivityPool</a></div><div class="ttdeci">static void clearActivityPool()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l00569">ActivityManager.cpp:569</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_a21b555fe8b75e3ba7854dd3c2e016b51"><div class="ttname"><a href="class_activity_manager.html#a21b555fe8b75e3ba7854dd3c2e016b51">ActivityManager::createInterpreter</a></div><div class="ttdeci">static void createInterpreter()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l00365">ActivityManager.cpp:365</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_a2ac5433e72cd154755540cd523871b10"><div class="ttname"><a href="class_activity_manager.html#a2ac5433e72cd154755540cd523871b10">ActivityManager::postTermination</a></div><div class="ttdeci">static void postTermination()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8hpp_source.html#l00171">ActivityManager.hpp:171</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_a374af8561e8974a80fb0f976eeeda701"><div class="ttname"><a href="class_activity_manager.html#a374af8561e8974a80fb0f976eeeda701">ActivityManager::waitingActivities</a></div><div class="ttdeci">static std::deque&lt; Activity * &gt; waitingActivities</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8hpp_source.html#l00198">ActivityManager.hpp:198</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_a3ae96cdf24c0cecc1074df9e60b4478c"><div class="ttname"><a href="class_activity_manager.html#a3ae96cdf24c0cecc1074df9e60b4478c">ActivityManager::waitingApiAccess</a></div><div class="ttdeci">static size_t waitingApiAccess</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8hpp_source.html#l00201">ActivityManager.hpp:201</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_a3c78d6dfe8be801f5533f5f2820d5570"><div class="ttname"><a href="class_activity_manager.html#a3c78d6dfe8be801f5533f5f2820d5570">ActivityManager::lastLockTime</a></div><div class="ttdeci">static uint64_t lastLockTime</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8hpp_source.html#l00202">ActivityManager.hpp:202</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_a49aa623a244c04ab727e9d421ac5ebcd"><div class="ttname"><a href="class_activity_manager.html#a49aa623a244c04ab727e9d421ac5ebcd">ActivityManager::interpreterInstances</a></div><div class="ttdeci">static size_t interpreterInstances</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8hpp_source.html#l00190">ActivityManager.hpp:190</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_a559621dc7d57535d6c7bb0ccc9de7a01"><div class="ttname"><a href="class_activity_manager.html#a559621dc7d57535d6c7bb0ccc9de7a01">ActivityManager::lockKernelImmediate</a></div><div class="ttdeci">static bool lockKernelImmediate()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l00773">ActivityManager.cpp:773</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_a57a2ec058a1772ac839aa0e7654e4041"><div class="ttname"><a href="class_activity_manager.html#a57a2ec058a1772ac839aa0e7654e4041">ActivityManager::addWaitingApiActivity</a></div><div class="ttdeci">static void addWaitingApiActivity(Activity *a)</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l00258">ActivityManager.cpp:258</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_a59f65b6fc5772088b35d9d4d062db793"><div class="ttname"><a href="class_activity_manager.html#a59f65b6fc5772088b35d9d4d062db793">ActivityManager::init</a></div><div class="ttdeci">static void init()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l00090">ActivityManager.cpp:90</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_a6364099f434f4c7e1110bfe7ecee1b01"><div class="ttname"><a href="class_activity_manager.html#a6364099f434f4c7e1110bfe7ecee1b01">ActivityManager::returnRootActivity</a></div><div class="ttdeci">static void returnRootActivity(Activity *activity)</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l00895">ActivityManager.cpp:895</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_a6dcf364f11149e8b8ae78c31e86ff460"><div class="ttname"><a href="class_activity_manager.html#a6dcf364f11149e8b8ae78c31e86ff460">ActivityManager::waitingAccess</a></div><div class="ttdeci">static size_t waitingAccess</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8hpp_source.html#l00200">ActivityManager.hpp:200</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_a79b68d826eb48037838a9eab89e730fe"><div class="ttname"><a href="class_activity_manager.html#a79b68d826eb48037838a9eab89e730fe">ActivityManager::currentActivity</a></div><div class="ttdeci">static Activity *volatile currentActivity</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8hpp_source.html#l00169">ActivityManager.hpp:169</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_a7bb06e29ceb45d2e89c08b38f8ca25b4"><div class="ttname"><a href="class_activity_manager.html#a7bb06e29ceb45d2e89c08b38f8ca25b4">ActivityManager::suspendDispatch</a></div><div class="ttdeci">static void suspendDispatch(Activity *activity)</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l01012">ActivityManager.cpp:1012</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_a7db2f7d7f13c9c57c76e81af1ebcd1de"><div class="ttname"><a href="class_activity_manager.html#a7db2f7d7f13c9c57c76e81af1ebcd1de">ActivityManager::hasWaiters</a></div><div class="ttdeci">static bool hasWaiters()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8hpp_source.html#l00067">ActivityManager.hpp:67</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_a80d7fbc18e694eb0cc49773a6a67c615"><div class="ttname"><a href="class_activity_manager.html#a80d7fbc18e694eb0cc49773a6a67c615">ActivityManager::createNewActivity</a></div><div class="ttdeci">static Activity * createNewActivity()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l00496">ActivityManager.cpp:496</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_a8461af3774422faea23d0d0e34d3d388"><div class="ttname"><a href="class_activity_manager.html#a8461af3774422faea23d0d0e34d3d388">ActivityManager::newActivation</a></div><div class="ttdeci">static RexxActivation * newActivation(Activity *activity, RoutineClass *routine, RexxCode *code, RexxString *calltype, RexxString *environment, ActivationContext context)</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l00414">ActivityManager.cpp:414</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_a9068817dc272f1346efebf50a437a250"><div class="ttname"><a href="class_activity_manager.html#a9068817dc272f1346efebf50a437a250">ActivityManager::shutdown</a></div><div class="ttdeci">static void shutdown()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l00391">ActivityManager.cpp:391</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_a9379da3941a3e1eb36fd23bccd2c6de5"><div class="ttname"><a href="class_activity_manager.html#a9379da3941a3e1eb36fd23bccd2c6de5">ActivityManager::lockKernel</a></div><div class="ttdeci">static void lockKernel()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8hpp_source.html#l00080">ActivityManager.hpp:80</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_a9d83248365955974c11dc5722066b655"><div class="ttname"><a href="class_activity_manager.html#a9d83248365955974c11dc5722066b655">ActivityManager::liveGeneral</a></div><div class="ttdeci">static void liveGeneral(MarkReason reason)</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l00114">ActivityManager.cpp:114</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_aa11d586f0ebd7e07264a00003cc42ed7"><div class="ttname"><a href="class_activity_manager.html#aa11d586f0ebd7e07264a00003cc42ed7">ActivityManager::live</a></div><div class="ttdeci">static void live(size_t)</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l00103">ActivityManager.cpp:103</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_aa5e18d89bf550489c15da86f9f21e117"><div class="ttname"><a href="class_activity_manager.html#aa5e18d89bf550489c15da86f9f21e117">ActivityManager::waitingAttaches</a></div><div class="ttdeci">static size_t waitingAttaches</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8hpp_source.html#l00199">ActivityManager.hpp:199</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_aa6584f2cc0d15c4a03d8999e079cdd30"><div class="ttname"><a href="class_activity_manager.html#aa6584f2cc0d15c4a03d8999e079cdd30">ActivityManager::terminateInterpreter</a></div><div class="ttdeci">static void terminateInterpreter()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l00374">ActivityManager.cpp:374</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_ab05bff78507794d1cd7753c5b2d188c1"><div class="ttname"><a href="class_activity_manager.html#ab05bff78507794d1cd7753c5b2d188c1">ActivityManager::createLocks</a></div><div class="ttdeci">static void createLocks()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l00746">ActivityManager.cpp:746</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_ab1db9333ee59809f09fac653510bcffa"><div class="ttname"><a href="class_activity_manager.html#ab1db9333ee59809f09fac653510bcffa">ActivityManager::haltActivity</a></div><div class="ttdeci">static bool haltActivity(thread_id_t thread_id, RexxString *description)</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l00628">ActivityManager.cpp:628</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_ab23aaa3f72c33cc165f02d35b3e9ef5f"><div class="ttname"><a href="class_activity_manager.html#ab23aaa3f72c33cc165f02d35b3e9ef5f">ActivityManager::getLocalEnvironment</a></div><div class="ttdeci">static RexxObject * getLocalEnvironment(RexxString *name)</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l01120">ActivityManager.cpp:1120</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_abd3e40501c41cb34177d3544f0c4a817"><div class="ttname"><a href="class_activity_manager.html#abd3e40501c41cb34177d3544f0c4a817">ActivityManager::exit</a></div><div class="ttdeci">static void exit(int retcode)</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l00721">ActivityManager.cpp:721</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_ac4eda8b811909cca248959db37e5834e"><div class="ttname"><a href="class_activity_manager.html#ac4eda8b811909cca248959db37e5834e">ActivityManager::kernelSemaphore</a></div><div class="ttdeci">static SysMutex kernelSemaphore</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8hpp_source.html#l00195">ActivityManager.hpp:195</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_ac5de661ac9df39905bcf382ac7e7089f"><div class="ttname"><a href="class_activity_manager.html#ac5de661ac9df39905bcf382ac7e7089f">ActivityManager::closeLocks</a></div><div class="ttdeci">static void closeLocks()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l00758">ActivityManager.cpp:758</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_acd99df1a0ccfc7e0cd21e6595a0b13ee"><div class="ttname"><a href="class_activity_manager.html#acd99df1a0ccfc7e0cd21e6595a0b13ee">ActivityManager::unlockKernel</a></div><div class="ttdeci">static void unlockKernel()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8hpp_source.html#l00087">ActivityManager.hpp:87</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_ad1342f694c4ade16b4ce6fc7deb1733b"><div class="ttname"><a href="class_activity_manager.html#ad1342f694c4ade16b4ce6fc7deb1733b">ActivityManager::getRootActivity</a></div><div class="ttdeci">static Activity * getRootActivity()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l00859">ActivityManager.cpp:859</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_ad1ee85752776416adf790ec6f39f5af8"><div class="ttname"><a href="class_activity_manager.html#ad1ee85752776416adf790ec6f39f5af8">ActivityManager::returnActivity</a></div><div class="ttdeci">static void returnActivity(Activity *)</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l00791">ActivityManager.cpp:791</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_ad31635138f600d263697c9791ee54fa5"><div class="ttname"><a href="class_activity_manager.html#ad31635138f600d263697c9791ee54fa5">ActivityManager::removeWaitingActivity</a></div><div class="ttdeci">static void removeWaitingActivity(Activity *waitingAct)</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l01063">ActivityManager.cpp:1063</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_ad6803dcbd0b41129f3e5a95b101f9868"><div class="ttname"><a href="class_activity_manager.html#ad6803dcbd0b41129f3e5a95b101f9868">ActivityManager::createCurrentActivity</a></div><div class="ttdeci">static Activity * createCurrentActivity()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l00530">ActivityManager.cpp:530</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_adb0c7cefcddab6472aafa4cf14d63276"><div class="ttname"><a href="class_activity_manager.html#adb0c7cefcddab6472aafa4cf14d63276">ActivityManager::sentinel</a></div><div class="ttdeci">static volatile bool sentinel</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8hpp_source.html#l00197">ActivityManager.hpp:197</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_ae62aa7eb85ba887e9351fef8886b7678"><div class="ttname"><a href="class_activity_manager.html#ae62aa7eb85ba887e9351fef8886b7678">ActivityManager::findActivity</a></div><div class="ttdeci">static Activity * findActivity()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l00710">ActivityManager.cpp:710</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_ae690a4e2ac463f50d4377a1f385aec64"><div class="ttname"><a href="class_activity_manager.html#ae690a4e2ac463f50d4377a1f385aec64">ActivityManager::dispatchNext</a></div><div class="ttdeci">static bool dispatchNext()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l00311">ActivityManager.cpp:311</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_aef4fd0c82b79fd109906b4c545c3179a"><div class="ttname"><a href="class_activity_manager.html#aef4fd0c82b79fd109906b4c545c3179a">ActivityManager::getLocal</a></div><div class="ttdeci">static DirectoryClass * getLocal()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l01135">ActivityManager.cpp:1135</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_af21c02d1b198da11b65681a71aed6b62"><div class="ttname"><a href="class_activity_manager.html#af21c02d1b198da11b65681a71aed6b62">ActivityManager::handleNestedActivity</a></div><div class="ttdeci">static void handleNestedActivity(Activity *newActivity, Activity *oldActivity)</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l00919">ActivityManager.cpp:919</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_af5ced23fc1e0e34c41447375535452bf"><div class="ttname"><a href="class_activity_manager.html#af5ced23fc1e0e34c41447375535452bf">ActivityManager::getActivity</a></div><div class="ttdeci">static Activity * getActivity()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l01095">ActivityManager.cpp:1095</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_aff7f8d031752047cc6980dfc2bca603d"><div class="ttname"><a href="class_activity_manager.html#aff7f8d031752047cc6980dfc2bca603d">ActivityManager::addWaitingActivity</a></div><div class="ttdeci">static void addWaitingActivity(Activity *a, bool release)</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l00133">ActivityManager.cpp:133</a></div></div>
<div class="ttc" id="aclass_activity_manager_html_aff9ff1ec4277c8f4689ca11db09a7b74"><div class="ttname"><a href="class_activity_manager.html#aff9ff1ec4277c8f4689ca11db09a7b74">ActivityManager::activityEnded</a></div><div class="ttdeci">static void activityEnded(Activity *)</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l00833">ActivityManager.cpp:833</a></div></div>
<div class="ttc" id="aclass_array_class_html_a0bcebe7be61cb31bd6dffff3f65dfb91"><div class="ttname"><a href="class_array_class.html#a0bcebe7be61cb31bd6dffff3f65dfb91">ArrayClass::append</a></div><div class="ttdeci">size_t append(RexxInternalObject *)</div><div class="ttdef"><b>Definition:</b> <a href="_array_class_8cpp_source.html#l00726">ArrayClass.cpp:726</a></div></div>
<div class="ttc" id="aclass_array_class_html_a9b1bdaa3efbb8fc70487082c6968ab9a"><div class="ttname"><a href="class_array_class.html#a9b1bdaa3efbb8fc70487082c6968ab9a">ArrayClass::removeItem</a></div><div class="ttdeci">RexxInternalObject * removeItem(RexxInternalObject *target)</div><div class="ttdef"><b>Definition:</b> <a href="_array_class_8cpp_source.html#l02217">ArrayClass.cpp:2217</a></div></div>
<div class="ttc" id="aclass_array_class_html_aa4e0c86824aaec36a0e8197c37a86c60"><div class="ttname"><a href="class_array_class.html#aa4e0c86824aaec36a0e8197c37a86c60">ArrayClass::items</a></div><div class="ttdeci">size_t items()</div><div class="ttdef"><b>Definition:</b> <a href="_array_class_8hpp_source.html#l00200">ArrayClass.hpp:200</a></div></div>
<div class="ttc" id="aclass_array_class_html_ac9ff63dbacda2000a4f783568b5428f2"><div class="ttname"><a href="class_array_class.html#ac9ff63dbacda2000a4f783568b5428f2">ArrayClass::get</a></div><div class="ttdeci">RexxInternalObject * get(size_t pos)</div><div class="ttdef"><b>Definition:</b> <a href="_array_class_8hpp_source.html#l00301">ArrayClass.hpp:301</a></div></div>
<div class="ttc" id="aclass_array_class_html_acc163bec438db906081313190032dcdc"><div class="ttname"><a href="class_array_class.html#acc163bec438db906081313190032dcdc">ArrayClass::lastIndex</a></div><div class="ttdeci">size_t lastIndex()</div><div class="ttdef"><b>Definition:</b> <a href="_array_class_8cpp_source.html#l01612">ArrayClass.cpp:1612</a></div></div>
<div class="ttc" id="aclass_array_class_html_af0c2bd6f0cc94c492c7119c43b8ea51e"><div class="ttname"><a href="class_array_class.html#af0c2bd6f0cc94c492c7119c43b8ea51e">ArrayClass::isEmpty</a></div><div class="ttdeci">bool isEmpty()</div><div class="ttdef"><b>Definition:</b> <a href="_array_class_8cpp_source.html#l00685">ArrayClass.cpp:685</a></div></div>
<div class="ttc" id="aclass_directory_class_html"><div class="ttname"><a href="class_directory_class.html">DirectoryClass</a></div><div class="ttdef"><b>Definition:</b> <a href="_directory_class_8hpp_source.html#l00049">DirectoryClass.hpp:50</a></div></div>
<div class="ttc" id="aclass_dispatch_section_html"><div class="ttname"><a href="class_dispatch_section.html">DispatchSection</a></div><div class="ttdef"><b>Definition:</b> <a href="_interpreter_8hpp_source.html#l00196">Interpreter.hpp:197</a></div></div>
<div class="ttc" id="aclass_dispatch_section_html_a79d53d4065c167674c799081f525f498"><div class="ttname"><a href="class_dispatch_section.html#a79d53d4065c167674c799081f525f498">DispatchSection::reacquire</a></div><div class="ttdeci">void reacquire()</div><div class="ttdef"><b>Definition:</b> <a href="_interpreter_8hpp_source.html#l00223">Interpreter.hpp:223</a></div></div>
<div class="ttc" id="aclass_dispatch_section_html_a95d468e85f726b8035498646338ee52d"><div class="ttname"><a href="class_dispatch_section.html#a95d468e85f726b8035498646338ee52d">DispatchSection::release</a></div><div class="ttdeci">void release()</div><div class="ttdef"><b>Definition:</b> <a href="_interpreter_8hpp_source.html#l00213">Interpreter.hpp:213</a></div></div>
<div class="ttc" id="aclass_global_protected_object_html"><div class="ttname"><a href="class_global_protected_object.html">GlobalProtectedObject</a></div><div class="ttdef"><b>Definition:</b> <a href="_global_protected_object_8hpp_source.html#l00046">GlobalProtectedObject.hpp:47</a></div></div>
<div class="ttc" id="aclass_interpreter_html_ae112be57922520b47dfe2af683f17770"><div class="ttname"><a href="class_interpreter.html#ae112be57922520b47dfe2af683f17770">Interpreter::createInterpreterInstance</a></div><div class="ttdeci">static InterpreterInstance * createInterpreterInstance()</div><div class="ttdef"><b>Definition:</b> <a href="_interpreter_8hpp_source.html#l00099">Interpreter.hpp:99</a></div></div>
<div class="ttc" id="aclass_interpreter_instance_html_a37d28d4ed8dc4a8442c0b7cb17f250f0"><div class="ttname"><a href="class_interpreter_instance.html#a37d28d4ed8dc4a8442c0b7cb17f250f0">InterpreterInstance::getRootActivity</a></div><div class="ttdeci">Activity * getRootActivity()</div><div class="ttdef"><b>Definition:</b> <a href="_interpreter_instance_8hpp_source.html#l00081">InterpreterInstance.hpp:81</a></div></div>
<div class="ttc" id="aclass_interpreter_instance_html_a3c3bad1a0127677d28af8150743df064"><div class="ttname"><a href="class_interpreter_instance.html#a3c3bad1a0127677d28af8150743df064">InterpreterInstance::terminate</a></div><div class="ttdeci">bool terminate()</div><div class="ttdef"><b>Definition:</b> <a href="_interpreter_instance_8cpp_source.html#l00468">InterpreterInstance.cpp:468</a></div></div>
<div class="ttc" id="aclass_method_class_html"><div class="ttname"><a href="class_method_class.html">MethodClass</a></div><div class="ttdef"><b>Definition:</b> <a href="_method_class_8hpp_source.html#l00085">MethodClass.hpp:86</a></div></div>
<div class="ttc" id="aclass_native_activation_html"><div class="ttname"><a href="class_native_activation.html">NativeActivation</a></div><div class="ttdef"><b>Definition:</b> <a href="_native_activation_8hpp_source.html#l00071">NativeActivation.hpp:72</a></div></div>
<div class="ttc" id="aclass_native_context_block_html_a4d568edf129d6cb25e88b723a3da6263"><div class="ttname"><a href="class_native_context_block.html#a4d568edf129d6cb25e88b723a3da6263">NativeContextBlock::NativeContextBlock</a></div><div class="ttdeci">NativeContextBlock()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l01152">ActivityManager.cpp:1152</a></div></div>
<div class="ttc" id="aclass_native_context_block_html_a55902c9218de1f2f15f7baae0966163a"><div class="ttname"><a href="class_native_context_block.html#a55902c9218de1f2f15f7baae0966163a">NativeContextBlock::instance</a></div><div class="ttdeci">InterpreterInstance * instance</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8hpp_source.html#l00414">ActivityManager.hpp:414</a></div></div>
<div class="ttc" id="aclass_native_context_block_html_a730574b7725f37909153d56411767d61"><div class="ttname"><a href="class_native_context_block.html#a730574b7725f37909153d56411767d61">NativeContextBlock::activity</a></div><div class="ttdeci">Activity * activity</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8hpp_source.html#l00413">ActivityManager.hpp:413</a></div></div>
<div class="ttc" id="aclass_native_context_block_html_aace83c4aa8537bd49bac339949332863"><div class="ttname"><a href="class_native_context_block.html#aace83c4aa8537bd49bac339949332863">NativeContextBlock::~NativeContextBlock</a></div><div class="ttdeci">~NativeContextBlock()</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l01176">ActivityManager.cpp:1176</a></div></div>
<div class="ttc" id="aclass_native_context_block_html_abc5f749266ad7811b454782236e67cf0"><div class="ttname"><a href="class_native_context_block.html#abc5f749266ad7811b454782236e67cf0">NativeContextBlock::protect</a></div><div class="ttdeci">RexxObject * protect(RexxObject *o)</div><div class="ttdef"><b>Definition:</b> <a href="_activity_manager_8cpp_source.html#l01197">ActivityManager.cpp:1197</a></div></div>
<div class="ttc" id="aclass_queue_class_html"><div class="ttname"><a href="class_queue_class.html">QueueClass</a></div><div class="ttdef"><b>Definition:</b> <a href="_queue_class_8hpp_source.html#l00049">QueueClass.hpp:50</a></div></div>
<div class="ttc" id="aclass_queue_class_html_abe80204f0e5173f7f58d64179494a8a7"><div class="ttname"><a href="class_queue_class.html#abe80204f0e5173f7f58d64179494a8a7">QueueClass::pull</a></div><div class="ttdeci">RexxInternalObject * pull()</div><div class="ttdef"><b>Definition:</b> <a href="_queue_class_8hpp_source.html#l00072">QueueClass.hpp:72</a></div></div>
<div class="ttc" id="aclass_resource_section_html"><div class="ttname"><a href="class_resource_section.html">ResourceSection</a></div><div class="ttdef"><b>Definition:</b> <a href="_interpreter_8hpp_source.html#l00151">Interpreter.hpp:152</a></div></div>
<div class="ttc" id="aclass_resource_section_html_a40efe610cb235621ddb0483b1f008c47"><div class="ttname"><a href="class_resource_section.html#a40efe610cb235621ddb0483b1f008c47">ResourceSection::release</a></div><div class="ttdeci">void release()</div><div class="ttdef"><b>Definition:</b> <a href="_interpreter_8hpp_source.html#l00168">Interpreter.hpp:168</a></div></div>
<div class="ttc" id="aclass_resource_section_html_ac598d3b93ac1b6aac6d33482fc38e05d"><div class="ttname"><a href="class_resource_section.html#ac598d3b93ac1b6aac6d33482fc38e05d">ResourceSection::reacquire</a></div><div class="ttdeci">void reacquire()</div><div class="ttdef"><b>Definition:</b> <a href="_interpreter_8hpp_source.html#l00178">Interpreter.hpp:178</a></div></div>
<div class="ttc" id="aclass_rexx_activation_html"><div class="ttname"><a href="class_rexx_activation.html">RexxActivation</a></div><div class="ttdef"><b>Definition:</b> <a href="_rexx_activation_8hpp_source.html#l00074">RexxActivation.hpp:75</a></div></div>
<div class="ttc" id="aclass_rexx_code_html"><div class="ttname"><a href="class_rexx_code.html">RexxCode</a></div><div class="ttdef"><b>Definition:</b> <a href="_rexx_code_8hpp_source.html#l00058">RexxCode.hpp:59</a></div></div>
<div class="ttc" id="aclass_rexx_object_html"><div class="ttname"><a href="class_rexx_object.html">RexxObject</a></div><div class="ttdef"><b>Definition:</b> <a href="_object_class_8hpp_source.html#l00407">ObjectClass.hpp:408</a></div></div>
<div class="ttc" id="aclass_rexx_string_html"><div class="ttname"><a href="class_rexx_string.html">RexxString</a></div><div class="ttdef"><b>Definition:</b> <a href="_string_class_8hpp_source.html#l00068">StringClass.hpp:69</a></div></div>
<div class="ttc" id="aclass_routine_class_html"><div class="ttname"><a href="class_routine_class.html">RoutineClass</a></div><div class="ttdef"><b>Definition:</b> <a href="_routine_class_8hpp_source.html#l00051">RoutineClass.hpp:52</a></div></div>
<div class="ttc" id="aclass_sys_activity_html_a3710e2ade99fbb283200ad60398e8e1c"><div class="ttname"><a href="class_sys_activity.html#a3710e2ade99fbb283200ad60398e8e1c">SysActivity::queryThreadID</a></div><div class="ttdeci">static thread_id_t queryThreadID()</div><div class="ttdef"><b>Definition:</b> <a href="unix_2_sys_activity_8cpp_source.html#l00099">unix/SysActivity.cpp:99</a></div></div>
<div class="ttc" id="aclass_sys_mutex_html"><div class="ttname"><a href="class_sys_mutex.html">SysMutex</a></div><div class="ttdef"><b>Definition:</b> <a href="unix_2_sys_semaphore_8hpp_source.html#l00075">unix/SysSemaphore.hpp:75</a></div></div>
<div class="ttc" id="aclass_sys_mutex_html_a2ccac2bd5f877849c676647d61d2e878"><div class="ttname"><a href="class_sys_mutex.html#a2ccac2bd5f877849c676647d61d2e878">SysMutex::close</a></div><div class="ttdeci">void close()</div><div class="ttdef"><b>Definition:</b> <a href="unix_2_sys_semaphore_8cpp_source.html#l00406">unix/SysSemaphore.cpp:406</a></div></div>
<div class="ttc" id="aclass_sys_mutex_html_a706d2372b863a8f06ddc94aeac6a7b3a"><div class="ttname"><a href="class_sys_mutex.html#a706d2372b863a8f06ddc94aeac6a7b3a">SysMutex::create</a></div><div class="ttdeci">void create(bool critical=false)</div><div class="ttdef"><b>Definition:</b> <a href="unix_2_sys_semaphore_8cpp_source.html#l00344">unix/SysSemaphore.cpp:344</a></div></div>
<div class="ttc" id="aclass_sys_mutex_html_a724aa1df1c40901fbe232e235ec27cee"><div class="ttname"><a href="class_sys_mutex.html#a724aa1df1c40901fbe232e235ec27cee">SysMutex::requestImmediate</a></div><div class="ttdeci">bool requestImmediate()</div><div class="ttdef"><b>Definition:</b> <a href="unix_2_sys_semaphore_8hpp_source.html#l00086">unix/SysSemaphore.hpp:86</a></div></div>
<div class="ttc" id="aclass_sys_semaphore_html"><div class="ttname"><a href="class_sys_semaphore.html">SysSemaphore</a></div><div class="ttdef"><b>Definition:</b> <a href="unix_2_sys_semaphore_8hpp_source.html#l00053">unix/SysSemaphore.hpp:53</a></div></div>
<div class="ttc" id="aclass_sys_semaphore_html_a7d0f7344b9320094fbcec9bf4a20bb51"><div class="ttname"><a href="class_sys_semaphore.html#a7d0f7344b9320094fbcec9bf4a20bb51">SysSemaphore::create</a></div><div class="ttdeci">void create()</div><div class="ttdef"><b>Definition:</b> <a href="unix_2_sys_semaphore_8cpp_source.html#l00172">unix/SysSemaphore.cpp:172</a></div></div>
<div class="ttc" id="aclass_sys_semaphore_html_a93cb3437378cdc63a5c6a3f00de88d7e"><div class="ttname"><a href="class_sys_semaphore.html#a93cb3437378cdc63a5c6a3f00de88d7e">SysSemaphore::close</a></div><div class="ttdeci">void close()</div><div class="ttdef"><b>Definition:</b> <a href="unix_2_sys_semaphore_8cpp_source.html#l00217">unix/SysSemaphore.cpp:217</a></div></div>
<div class="ttc" id="aclass_sys_semaphore_html_ab9723befb919f4bccf928829c966ce2c"><div class="ttname"><a href="class_sys_semaphore.html#ab9723befb919f4bccf928829c966ce2c">SysSemaphore::reset</a></div><div class="ttdeci">void reset()</div><div class="ttdef"><b>Definition:</b> <a href="unix_2_sys_semaphore_8cpp_source.html#l00310">unix/SysSemaphore.cpp:310</a></div></div>
<div class="ttc" id="aunix_2rexxapitypes_8h_html_ad16be474ba962961346dd85d95385de9"><div class="ttname"><a href="unix_2rexxapitypes_8h.html#ad16be474ba962961346dd85d95385de9">thread_id_t</a></div><div class="ttdeci">pthread_t thread_id_t</div><div class="ttdef"><b>Definition:</b> <a href="unix_2rexxapitypes_8h_source.html#l00066">unix/rexxapitypes.h:66</a></div></div>
<div class="ttc" id="awindows_2rexxapitypes_8h_html_aec6fcb673ff035718c238c8c9d544c47"><div class="ttname"><a href="windows_2rexxapitypes_8h.html#aec6fcb673ff035718c238c8c9d544c47">uint64_t</a></div><div class="ttdeci">unsigned __int64 uint64_t</div><div class="ttdef"><b>Definition:</b> <a href="windows_2rexxapitypes_8h_source.html#l00078">windows/rexxapitypes.h:78</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.2-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_2b8d323c7289fed1299e6f1b6909d41b.html">oorexx</a></li><li class="navelem"><a class="el" href="dir_2dfb7423ce64cb60f62cee208bb73ae3.html">official</a></li><li class="navelem"><a class="el" href="dir_63144926d93644d0b571decfac4c5baa.html">main</a></li><li class="navelem"><a class="el" href="dir_5131a42d519b9b019d5264fc1f0fe4ab.html">trunk</a></li><li class="navelem"><a class="el" href="dir_07b471ff108ade29d714c67783960c47.html">interpreter</a></li><li class="navelem"><a class="el" href="dir_70fd37ea036e91be0334bd948f034e0e.html">concurrency</a></li><li class="navelem"><a class="el" href="_activity_manager_8cpp.html">ActivityManager.cpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
<!-- javascript code to insert the title in the condensed index (tabs) -->
<!-- See the function initMenu in menu.js:
     The condensed index is a list <ul> of several items <li>: Main Page, Classes, Files.
     I append a new item <li> which display the project name. -->
<script type="text/javascript">
$(function() {
  $('#main-menu').append('<li class="title" style="margin-left:3mm">ooRexx</li>')
});
</script>
<!-- end of javascript code -->
</body>
</html>
