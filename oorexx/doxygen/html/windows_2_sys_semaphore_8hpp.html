<!-- HTML header for doxygen 1.9.2-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ooRexx: SysSemaphore.hpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!--
    Removed completely the TITLEAREA because I don't like the loss of space.
    I want the title in the condensed index (tabs) at top of each HTML page.
    The insertion of the title is managed by javascript code in the footer,
    because this code must be executed AFTER the creation of the condensed index.
    Must have this setting to display the condensed index:
    DISABLE_INDEX = NO
-->
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('windows_2_sys_semaphore_8hpp.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">windows/SysSemaphore.hpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="rexx_8h_source.html">rexx.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="windows_2_sys_thread_8hpp_source.html">SysThread.hpp</a>&quot;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for windows/SysSemaphore.hpp:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="windows_2_sys_semaphore_8hpp__incl.svg" width="547" height="263"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="windows_2_sys_semaphore_8hpp__dep__incl.svg" width="147" height="114"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
</div>
<p><a href="windows_2_sys_semaphore_8hpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_sys_semaphore.html">SysSemaphore</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_sys_mutex.html">SysMutex</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a5f8ee8c62dbd984d9f00f68a69c0aa30"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="windows_2_sys_semaphore_8hpp.html#a5f8ee8c62dbd984d9f00f68a69c0aa30">waitHandle</a> (HANDLE s, bool noMessageLoop)</td></tr>
<tr class="separator:a5f8ee8c62dbd984d9f00f68a69c0aa30"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a540bdd2fd5f206bf9dca031ef87f7c72"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="windows_2_sys_semaphore_8hpp.html#a540bdd2fd5f206bf9dca031ef87f7c72">waitHandle</a> (HANDLE s, <a class="el" href="windows_2rexxapitypes_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> timeout, bool noMessageLoop)</td></tr>
<tr class="separator:a540bdd2fd5f206bf9dca031ef87f7c72"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a5f8ee8c62dbd984d9f00f68a69c0aa30"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5f8ee8c62dbd984d9f00f68a69c0aa30">&#9670;&nbsp;</a></span>waitHandle() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool waitHandle </td>
          <td>(</td>
          <td class="paramtype">HANDLE&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>bypassMessageLoop</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p class="">Wait for a synchronization object to be in the signaled state.</p>
<p class="">Any thread that creates windows must process messages. A thread that calls WaitForSingelObject with an infinite timeout risks deadlocking the system. MS's solution for this is to use MsgWaitForMultipleObjects to wait on the object, or a new message arriving in the message queue. Some threads create windows indirectly, an example is COM with CoInitialize. Since we can't know if the current thread has a message queue that needs processing, we use MsgWaitForMultipleObjects.</p>
<p class="">However, with the introduction of the C++ native API in ooRexx 4.0.0, it became possible for external native libraries to attach a thread with an active window procedure to the interpreter. If a wait is done on that thread, here in <a class="el" href="windows_2_sys_semaphore_8hpp.html#a5f8ee8c62dbd984d9f00f68a69c0aa30">waitHandle()</a>, PeekMessage() causes non-queued messages to be dispatched, and the window procedure is reentered. This can cause the Rexx program to hang. In addition, in the one known extension where this problem happens, ooDialog, the messages need to be passed to the dialog manager rather than dispatched directly to the window.</p>
<p class="">For this special case, the thread can explicity ask, through <a class="el" href="windows_2_misc_system_8cpp.html#ab49ed118f54f942a6aa479232d8de9a8">RexxSetProcessMessages()</a>, that messages are <em>not</em> processed during this wait. Thread local storage is used to keep track of a flag signalling this case on a per-thread basis.</p>
<p class="">Note that MsgWaitForMultipleObjects only returns if a new message is placed in the queue. PeekMessage alters the state of all messages in the queue so that they are no longer 'new.' Once PeekMessage is called, all the messages on the queue need to be processed. </p>

<p class="definition">Definition at line <a class="el" href="windows_2_sys_semaphore_8hpp_source.html#l00182">182</a> of file <a class="el" href="windows_2_sys_semaphore_8hpp_source.html">windows/SysSemaphore.hpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="windows_2_sys_semaphore_8hpp_source.html#l00112">SysMutex::request()</a>, and <a class="el" href="windows_2_sys_semaphore_8hpp_source.html#l00066">SysSemaphore::wait()</a>.</p>

</div>
</div>
<a id="a540bdd2fd5f206bf9dca031ef87f7c72"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a540bdd2fd5f206bf9dca031ef87f7c72">&#9670;&nbsp;</a></span>waitHandle() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool waitHandle </td>
          <td>(</td>
          <td class="paramtype">HANDLE&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="windows_2rexxapitypes_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td>
          <td class="paramname"><em>timeOut</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>bypassMessageLoop</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p class="">Wait for a synchronization object to be in the signaled state.</p>
<p class="">Any thread that creates windows must process messages. A thread that calls WaitForSingelObject with an infinite timeout risks deadlocking the system. MS's solution for this is to use MsgWaitForMultipleObjects to wait on the object, or a new message arriving in the message queue. Some threads create windows indirectly, an example is COM with CoInitialize. Since we can't know if the current thread has a message queue that needs processing, we use MsgWaitForMultipleObjects.</p>
<p class="">However, with the introduction of the C++ native API in ooRexx 4.0.0, it became possible for external native libraries to attach a thread with an active window procedure to the interpreter. If a wait is done on that thread, here in <a class="el" href="windows_2_sys_semaphore_8hpp.html#a5f8ee8c62dbd984d9f00f68a69c0aa30">waitHandle()</a>, PeekMessage() causes non-queued messages to be dispatched, and the window procedure is reentered. This can cause the Rexx program to hang. In addition, in the one known extension where this problem happens, ooDialog, the messages need to be passed to the dialog manager rather than dispatched directly to the window.</p>
<p class="">For this special case, the thread can explicity ask, through <a class="el" href="windows_2_misc_system_8cpp.html#ab49ed118f54f942a6aa479232d8de9a8">RexxSetProcessMessages()</a>, that messages are <em>not</em> processed during this wait. Thread local storage is used to keep track of a flag signalling this case on a per-thread basis.</p>
<p class="">Note that MsgWaitForMultipleObjects only returns if a new message is placed in the queue. PeekMessage alters the state of all messages in the queue so that they are no longer 'new.' Once PeekMessage is called, all the messages on the queue need to be processed. </p>

<p class="definition">Definition at line <a class="el" href="windows_2_sys_semaphore_8hpp_source.html#l00248">248</a> of file <a class="el" href="windows_2_sys_semaphore_8hpp_source.html">windows/SysSemaphore.hpp</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.2-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_2b8d323c7289fed1299e6f1b6909d41b.html">oorexx</a></li><li class="navelem"><a class="el" href="dir_2dfb7423ce64cb60f62cee208bb73ae3.html">official</a></li><li class="navelem"><a class="el" href="dir_63144926d93644d0b571decfac4c5baa.html">main</a></li><li class="navelem"><a class="el" href="dir_5131a42d519b9b019d5264fc1f0fe4ab.html">trunk</a></li><li class="navelem"><a class="el" href="dir_060f6f978d6f78ff04450bb545771af6.html">common</a></li><li class="navelem"><a class="el" href="dir_296764aac95bf0afb3b887e07c09edbe.html">platform</a></li><li class="navelem"><a class="el" href="dir_b0d6a395b4955762fa0c6c1be7d1f2b3.html">windows</a></li><li class="navelem"><a class="el" href="windows_2_sys_semaphore_8hpp.html">SysSemaphore.hpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
<!-- javascript code to insert the title in the condensed index (tabs) -->
<!-- See the function initMenu in menu.js:
     The condensed index is a list <ul> of several items <li>: Main Page, Classes, Files.
     I append a new item <li> which display the project name. -->
<script type="text/javascript">
$(function() {
  $('#main-menu').append('<li class="title" style="margin-left:3mm">ooRexx</li>')
});
</script>
<!-- end of javascript code -->
</body>
</html>
